<!DOCTYPE html><html><head><title>otis.js</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="../../doc-style.css"><script src="../../doc-filelist.js"></script><script>var relativeDir = '../../', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="../../doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"><div class="heading h1"><a href="#otis.js">otis.js</a></div></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="otis.js">
  <h1>
    <a href="#otis.js" class="pilcrow">&#182;</a>
    otis.js
  </h1>
</div>
</div><div class="body"><p>A highly customizable, extremely simple documentation generator based on</p>


<ul>
<li><a href="http://jashkenas.github.com/docco/">jashkenas / <strong>docco</strong></a></li>
<li><a href="https://github.com/mbrevoort/docco-husky">mbrevoort / <strong>docco-husky</strong></a></li>
<li><a href="http://jbt.github.com/docker">jbt / <strong>docker</strong></a></li>
</ul>


<p><strong>otis</strong> was once a really simple documentation generator -- <strong>docker</strong>.  <strong>docker</strong> originally
started out as a pure-javascript port of <strong>docco</strong>, but eventually gained many extra little features
that somewhat break docco's philosophy of being a quick-and-dirty thing.</p>

<p><strong>docker</strong> was based on <strong>docco</strong>'s coffeescript source, but converted to javascript.</p>

<p><strong>otis</strong> is based on <strong>docker</strong>, but has been re-converted to coffeescript.</p>

<p>especially given that some of the conversion was made using the fantastic (but not infallible)
(<a href='http://js2coffee.org'>http://js2coffee.org</a>), you might notice some strange code artifacts here and there -- javascript-isms
converted into coffeescript, and coffeescript-isms converted <em>through</em> javascript back into itself.</p>

<p>otis source code can be found on GitHub at <a href="https://github.com/brynbellomy/otis">brynbellomy / otis</a></p>

<p>By the way, this page is the result of running otis against itself (with some additional custom CSS appended).</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">consolidate</span><span class="p">,</span> <span class="nx">dox</span><span class="p">,</span> <span class="nx">exec</span><span class="p">,</span> <span class="nx">fs</span><span class="p">,</span> <span class="nx">mkdirp</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">spawn</span><span class="p">,</span> <span class="nx">watchr</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span>
  <span class="nx">__bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">me</span><span class="p">){</span> <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="p">};</span> <span class="p">};</span>

<span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>

<span class="nx">dox</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dox&quot;</span><span class="p">);</span>

<span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">);</span>

<span class="nx">_ref</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;child_process&quot;</span><span class="p">),</span> <span class="nx">exec</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">exec</span><span class="p">,</span> <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">spawn</span><span class="p">;</span>

<span class="nx">watchr</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;watchr&quot;</span><span class="p">);</span>

<span class="nx">mkdirp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mkdirp&quot;</span><span class="p">);</span>

<span class="nx">consolidate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;consolidate&quot;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">Otis</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## Otis()</p>

<p>Creates a new otis instance. All methods are called on one instance of this object.</p>

<p>Input arguments are an object containing any of the keys</p>

<ul>
<li><code>inDir</code></li>
<li><code>outDir</code></li>
<li><code>tplDir</code>,</li>
<li><code>tplEngine</code></li>
<li><code>tplExtension</code></li>
<li><code>markdownEngine</code></li>
<li><code>colorScheme</code></li>
<li><code>css</code></li>
<li><code>index</code></li>
<li><code>tolerant</code></li>
<li><code>onlyUpdated</code></li>
<li><code>ignoreHidden</code></li>
<li><code>sidebarState</code></li>
<li><p><code>exclude</code></p>

<p>@constructor
@param {object} opts</p></li>
</ul></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Otis</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">renderCodeHtml</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderCodeHtml</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">highlighExtractedCode</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlighExtractedCode</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlight</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">pygments</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pygments</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">languageParams</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languageParams</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">parseSections</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseSections</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">addFileToTree</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addFileToTree</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">queueFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queueFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">clean</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">finished</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">watch</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watch</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">}</span>

  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseOpts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span>
      <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">inDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
      <span class="nx">outDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;doc&quot;</span><span class="p">),</span>
      <span class="nx">tplDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span> <span class="s2">&quot;res&quot;</span><span class="p">),</span>
      <span class="nx">tplEngine</span><span class="o">:</span> <span class="s2">&quot;internal&quot;</span><span class="p">,</span>
      <span class="nx">tplExtension</span><span class="o">:</span> <span class="s2">&quot;jst&quot;</span><span class="p">,</span>
      <span class="nx">markdownEngine</span><span class="o">:</span> <span class="s2">&quot;marked&quot;</span><span class="p">,</span>
      <span class="nx">colourScheme</span><span class="o">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
      <span class="nx">css</span><span class="o">:</span> <span class="p">[],</span>
      <span class="nx">index</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">tolerant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">onlyUpdated</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">ignoreHidden</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">sidebarState</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">exclude</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">};</span>
    <span class="nx">_fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">defaults</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_fn</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">inDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">inDir</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">outDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">outDir</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tplDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">tplDir</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tplEngine</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">tplEngine</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tplExtension</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">tplExtension</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">markdownEngine</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">markdownEngine</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">css</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">css</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">tolerant</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ignoreHidden</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">ignoreHidden</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sidebarState</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">exclude</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^(&quot;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">exclude</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span> <span class="s2">&quot;\\.&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\*/g</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)(/|$)&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colorScheme</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">opts</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colorScheme</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_renderMarkdown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fn</span><span class="p">;</span>
      <span class="nx">fn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">markdownEngine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">&quot;gfm&quot;</span><span class="o">:</span>
          <span class="nx">fn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;github-flavored-markdown&quot;</span><span class="p">).</span><span class="nx">parse</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;showdown&quot;</span><span class="o">:</span>
          <span class="nx">fn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/../res/showdown&quot;</span><span class="p">).</span><span class="nx">Showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;marked&quot;</span><span class="o">:</span>
          <span class="nx">fn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;marked&quot;</span><span class="p">);</span>
          <span class="nx">fn</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span>
            <span class="nx">gfm</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">pedantic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">sanitize</span><span class="o">:</span> <span class="kc">false</span>
          <span class="p">});</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
          <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## doc</p>

<p>Generates documentation for specified files.</p>

<p>@param {Array} files Array of file paths relative to the <code>inDir</code> to generate documentation for.</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">[].</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">,</span> <span class="nx">files</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## watch</p>

<p>Watches the input directory for file changes and updates docs whenever a file is updated</p>

<p>@param {Array} files Array of file paths relative to the <code>inDir</code> to generate documentation for.</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">watch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">uto</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">watching</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span> <span class="o">=</span> <span class="nx">files</span><span class="p">;</span>
    <span class="nx">uto</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">uto</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">250</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">clean</span><span class="p">();</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">uto</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">watchr</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uto</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">uto</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}),</span> <span class="kc">null</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## finished</p>

<p>Callback function fired when processing is finished.</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">red</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watching</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Done. Waiting for changes...&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Done.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## clean</p>

<p>Clears out any instance variables so this otis can be rerun</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## addNextFile</p>

<p>Process the next file on the scan queue. If it's a directory, list all the children and queue those.
  If it's a file, add it to the queue.</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addNextFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">currFile</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
    <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">filename</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">filename</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">currFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>
      <span class="nx">cb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readlink</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">currFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">currFile</span><span class="p">),</span> <span class="nx">link</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unable to follow symlink to &quot;</span> <span class="o">+</span> <span class="nx">currFile</span> <span class="o">+</span> <span class="s2">&quot;: file does not exist&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">maybe</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">maybe</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">ignoreHidden</span> <span class="o">&amp;&amp;</span> <span class="nx">maybe</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[\._]/</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="nx">self</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">maybe</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">queueFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## queueFile</p>

<p>Queues a file for processing, and additionally stores it in the folder tree</p>

<p>@param {string} filename Name of the file to queue</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">queueFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## addFileToTree</p>

<p>Adds a file to the file tree to show in the sidebar. This used to be in <code>queueFile</code> but
  since we're now only deciding whether or not the file can be included at the point of
  reading it, this has to happen later.</p>

<p>@param {string} filename Name of file to add to the tree</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addFileToTree</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">currDir</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">pathSeparator</span><span class="p">;</span>
    <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nx">filename</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="nx">pathSeparator</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([\/\\])/g</span><span class="p">,</span> <span class="s2">&quot;\\$1&quot;</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nx">bits</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">);</span>
    <span class="nx">currDir</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tree</span><span class="p">;</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
        <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="nx">currDir</span> <span class="o">=</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">bits</span><span class="p">[</span><span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## processNextFile</p>

<p>Take the next file off the queue and process it</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processNextFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## generateDoc</p>

<p><em>This is where the magic happens</em></p>

<p>Generate the documentation for a file</p>

<p>@param {string} filename File name to generate documentation for
  @param {function} cb Callback function to execute when we're done</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateDoc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">infilename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">filename</span><span class="p">,</span>
      <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">filename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">infilename</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">shouldProcess</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shouldProcess</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">sections</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">lang</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">languageParams</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">_this</span><span class="p">.</span><span class="nx">addFileToTree</span><span class="p">(</span><span class="nx">infilename</span><span class="p">);</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">lang</span><span class="p">].</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s2">&quot;markdown&quot;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
          <span class="k">case</span> <span class="s2">&quot;code&quot;</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">default</span><span class="o">:</span>
            <span class="nx">sections</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">parseSections</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">lang</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">highlight</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">renderCodeHtml</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## decideWhetherToProcess</p>

<p>Decide whether or not a file should be processed. If the <code>onlyUpdated</code>
  flag was set on initialization, only allow processing of files that
  are newer than their counterpart generated doc file.</p>

<p>Fires a callback function with either true or false depending on whether
  or not the file should be processed</p>

<p>@param {string} filename The name of the file to check
  @param {function} callback Callback function</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">outFile</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## fileIsNewer</p>

<p>Sees whether one file is newer than another</p>

<p>@param {string} file File to check
  @param {string} otherFile File to compare to
  @param {function} callback Callback to fire with true if file is newer than otherFile</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fileIsNewer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">otherFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">otherFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">outStat</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="s2">&quot;ENOENT&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">inStat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="o">+</span><span class="nx">inStat</span><span class="p">.</span><span class="nx">mtime</span> <span class="o">&gt;</span> <span class="o">+</span><span class="nx">outStat</span><span class="p">.</span><span class="nx">mtime</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## parseSections</p>

<p>Parse the content of a file into individual sections.
  A section is defined to be one block of code with an accompanying comment</p>

<p>Returns an array of section objects, which take the form
  <code>js
  {
  doc_text: 'foo', // String containing comment content
  code_text: 'bar' // Accompanying code
  }
</code>
  @param {string} data The contents of the script file
  @param {string} language The language of the script file</p>

<p>@return {Array} array of section objects</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseSections</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">codeLines</span><span class="p">,</span> <span class="nx">commentRegex</span><span class="p">,</span> <span class="nx">doxData</span><span class="p">,</span> <span class="nx">inMultiLineComment</span><span class="p">,</span> <span class="nx">md</span><span class="p">,</span> <span class="nx">multiLine</span><span class="p">,</span> <span class="nx">numSpacesIndent</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span>
      <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">md</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">stripParas</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
      <span class="nx">h</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">_renderMarkdown</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^\s*|\s*$)/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">));</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">stripParas</span> <span class="o">?</span> <span class="nx">h</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/?p&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">h</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">codeLines</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
    <span class="nx">sections</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">];</span>
    <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">docs</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">code</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
    <span class="p">};</span>
    <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">numSpacesIndent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">multiLine</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="nx">doxData</span> <span class="o">=</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">commentRegex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\s*&quot;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s2">&quot;\\s?&quot;</span><span class="p">);</span>
    <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;async&quot;</span><span class="p">);</span>
    <span class="nx">async</span><span class="p">.</span><span class="nx">forEachSeries</span><span class="p">(</span><span class="nx">codeLines</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">,</span> <span class="nx">forEachCb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fixed</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">matchable</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">matchable</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([&quot;&#39;])(?:\\.|(?!\1).)*\1/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inMultiLineComment</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">dox</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">;</span>
              <span class="k">try</span> <span class="p">{</span>
                <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">multiLine</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">multiLine</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;/**&quot;</span> <span class="o">+</span> <span class="nx">multiLine</span> <span class="o">+</span> <span class="s2">&quot;*/&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
                <span class="nx">fixed</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">line</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
                  <span class="nx">fixed</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^ {&quot;</span> <span class="o">+</span> <span class="nx">numSpacesIndent</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
                <span class="p">}</span>
                <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;eyes&#39;</span><span class="p">).</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">fixed</span><span class="p">);</span>
                <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">fixed</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
                <span class="nx">doxData</span> <span class="o">=</span> <span class="nx">dox</span><span class="p">.</span><span class="nx">parseComments</span><span class="p">(</span><span class="nx">multiLine</span><span class="p">,</span> <span class="p">{</span>
                  <span class="nx">raw</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">})[</span><span class="mi">0</span><span class="p">];</span>
                <span class="nx">doxData</span><span class="p">.</span><span class="nx">md</span> <span class="o">=</span> <span class="nx">md</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;dox&quot;</span><span class="p">,</span> <span class="nx">doxData</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
                  <span class="p">}</span>
                  <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="nx">rendered</span><span class="p">;</span>
                  <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
                <span class="p">});</span>
              <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Dox error: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
                <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
                <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
              <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">multiLine</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">_this</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
              <span class="nx">docs</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="nx">code</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
            <span class="p">};</span>
          <span class="p">}</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">numSpacesIndent</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span> <span class="o">||</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/#!/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">docs</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nx">code</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
          <span class="p">};</span>
        <span class="p">}</span>
        <span class="nx">line</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">line</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span> <span class="o">||</span> <span class="o">!</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">code</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">sections</span><span class="p">;</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## languageParams</p>

<p>Provides language-specific params for a given file name.</p>

<p>@param {string} filename The name of the file to test
  @param {string} filedata The contents of the file (to check for shebang)
  @return {object} Object containing all of the language-specific params</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languageParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">filedata</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ext</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">shebangRegex</span><span class="p">;</span>
    <span class="nx">ext</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
    <span class="nx">ext</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\./</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ext</span> <span class="o">===</span> <span class="s2">&quot;.C&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;cpp&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">ext</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">shebangRegex</span> <span class="o">=</span> <span class="sr">/^\n*#!\s*(?:\/usr\/bin\/env)?\s*(?:[^\n]*\/)*([^\/\n]+)(?:\n|$)/</span><span class="p">;</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="nx">shebangRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">filedata</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">executables</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">executables</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">j</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  The language params can have the following keys:</p>

<ul>
<li><code>name</code>: Name of Pygments lexer to use</li>
<li><code>comment</code>: String flag for single-line comments</li>
<li><code>multiline</code>: Two-element array of start and end flags for block comments</li>
<li><code>commentsIgnore</code>: Regex of comments to strip completely (don't even doc)</li>
<li><code>dox</code>: Whether to run block comments through Dox</li>
<li><code>type</code>: Either <code>'code'</code> (default) or <code>'markdown'</code> - format of page to render</li>
</ul></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languages</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">javascript</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;js&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">],</span>
      <span class="nx">commentsIgnore</span><span class="o">:</span> <span class="sr">/^\s*\/\/=/</span><span class="p">,</span>
      <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">coffeescript</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/^(\s*)###/</span><span class="p">,</span> <span class="sr">/###\s*$/</span><span class="p">],</span>
      <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">ruby</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;rb&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;ruby&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\=begin/</span><span class="p">,</span> <span class="sr">/\=end/</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">python</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;py&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
    <span class="p">},</span>
    <span class="nx">perl</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;pm&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;perl&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
    <span class="p">},</span>
    <span class="nx">c</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;gcc&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">objc</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;clang&quot;</span><span class="p">,</span> <span class="s2">&quot;gcc&quot;</span><span class="p">],</span>
      <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">cpp</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;cpp&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;g++&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">csharp</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;cs&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">java</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;java&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">],</span>
      <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">php</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;php&quot;</span><span class="p">,</span> <span class="s2">&quot;php3&quot;</span><span class="p">,</span> <span class="s2">&quot;php4&quot;</span><span class="p">,</span> <span class="s2">&quot;php5&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;php&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">],</span>
      <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">actionscript</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;as&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
      <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">sh</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;sh&quot;</span><span class="p">],</span>
      <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="s2">&quot;zsh&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
    <span class="p">},</span>
    <span class="nx">yaml</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">],</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
    <span class="p">},</span>
    <span class="nx">markdown</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;md&quot;</span><span class="p">,</span> <span class="s2">&quot;mkd&quot;</span><span class="p">,</span> <span class="s2">&quot;markdown&quot;</span><span class="p">],</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;markdown&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## pygments</p>

<p>Runs a given block of code through pygments</p>

<p>@param {string} data The code to give to Pygments
  @param {string} language The name of the Pygments lexer to use
  @param {function} cb Callback to fire with Pygments output</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pygments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">pyg</span><span class="p">,</span> <span class="nx">pygArgs</span><span class="p">;</span>
    <span class="nx">pygArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-g&quot;</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pygArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="nx">language</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="nx">pyg</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s2">&quot;pygmentize&quot;</span><span class="p">,</span> <span class="nx">pygArgs</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;-O&quot;</span><span class="p">,</span> <span class="s2">&quot;encoding=utf-8,tabsize=2&quot;</span><span class="p">]));</span>
    <span class="nx">pyg</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="p">});</span>
    <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unable to write to Pygments stdin: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">out</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">pyg</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">writable</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## highlight</p>

<p>Highlights all the sections of a file using <strong>pygments</strong>
  Given an array of section objects, loop through them, and for each
  section generate pretty html for the comments and the code, and put them in
  <code>docHtml</code> and <code>codeHtml</code> respectively</p>

<p>@param {Array} sections Array of section objects
  @param {string} language Language ith which to highlight the file
  @param {function} cb Callback function to fire when we're done</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">input</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span>
      <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">];</span>
    <span class="nx">input</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">code</span><span class="p">);</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s2">&quot;----{DIVIDER_THING}----\n&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pygments</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
      <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;&lt;\/div&gt;\s*$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">bits</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\n*&lt;span class=\&quot;c[1p]?\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s2">&quot;----\\{DIVIDER_THING\\}----&lt;\\/span&gt;\\n*&quot;</span><span class="p">));</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">++</span><span class="nx">_i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">section</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">codeHtml</span> <span class="o">=</span> <span class="s2">&quot;&lt;div class=\&quot;highlight\&quot;&gt;&lt;pre&gt;&quot;</span> <span class="o">+</span> <span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/pre&gt;&lt;/div&gt;&quot;</span><span class="p">;</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">_renderMarkdown</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">);</span>
        <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## processDocCodeBlocks</p>

<p>Goes through all the HTML generated from comments, finds any code blocks
  and highlights them</p>

<p>@param {Array} sections Sections array as above
  @param {function} cb Callback to fire when done</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
    <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">next</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## extractDocCode</p>

<p>Extract and highlight code blocks in formatted HTML output from showdown</p>

<p>@param {string} html The HTML to process
  @param {function} cb Callback function to fire when done</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extractDocCode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">codeBlocks</span><span class="p">;</span>
    <span class="nx">codeBlocks</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;pre&gt;&lt;code(\slanguage=&#39;([a-z]*)&#39;)?&gt;([^&lt;]*)&lt;\/code&gt;&lt;\/pre&gt;/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wholeMatch</span><span class="p">,</span> <span class="nx">langBlock</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">langBlock</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">language</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;div class=&#39;highlight&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">wholeMatch</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">block</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;gt;/g</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;lt;/g</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;amp;/</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="s2">&quot;\n\n~C&quot;</span> <span class="o">+</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">language</span><span class="o">:</span> <span class="nx">language</span><span class="p">,</span>
        <span class="nx">code</span><span class="o">:</span> <span class="nx">block</span><span class="p">,</span>
        <span class="nx">i</span><span class="o">:</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;C\n\n&quot;</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">highlighExtractedCode</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">codeBlocks</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## highlightExtractedCode</p>

<p>Loops through all extracted code blocks and feeds them through pygments
  for code highlighting. Unfortunately the only way to do this that's able
  to cater for all situations is to spawn a new pygments process for each
  code block (as different blocks might be in different languages). If anyone
  knows of a more efficient way of doing this, please let me know.</p>

<p>@param {string} html The HTML the code has been extracted from
  @param {Array} codeBlocks Array of extracted code blocks as above
  @param {function} cb Callback to fire when we're done with processed HTML</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlighExtractedCode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">codeBlocks</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
    <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">next</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">nextBlock</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">nextBlock</span> <span class="o">=</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">pygments</span><span class="p">(</span><span class="nx">nextBlock</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">nextBlock</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;pre&gt;/</span><span class="p">,</span> <span class="s2">&quot;&lt;pre&gt;&lt;code&gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;/</span><span class="p">,</span> <span class="s2">&quot;&lt;/code&gt;&lt;/pre&gt;&quot;</span><span class="p">);</span>
        <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;\n~C&quot;</span> <span class="o">+</span> <span class="nx">nextBlock</span><span class="p">.</span><span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;C\n&quot;</span><span class="p">,</span> <span class="nx">out</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## addAnchors</p>

<p>Automatically assign an id to each section based on any headings.</p>

<p>@param {object} section The section object to look at
  @param {number} idx The index of the section in the whole array.</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addAnchors</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">docHtml</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">headings</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">docHtml</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&lt;h[0-9]&gt;/</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">docHtml</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&lt;h([0-9])&gt;)(.*)(&lt;\/h\2&gt;)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span><span class="p">;</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">middle</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;[^&gt;]*&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^a-zA-Z0-9\_\.]/g</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">);</span>
        <span class="nx">headings</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
          <span class="nx">text</span><span class="o">:</span> <span class="nx">middle</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;[^&gt;]*&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
          <span class="nx">level</span><span class="o">:</span> <span class="nx">level</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="s2">&quot;\n&lt;div class=\&quot;pilwrap\&quot; id=\&quot;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;\n  &quot;</span> <span class="o">+</span> <span class="nx">start</span> <span class="o">+</span> <span class="s2">&quot;\n    &lt;a href=\&quot;#&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;\&quot; class=\&quot;pilcrow\&quot;&gt;&amp;#182;&lt;/a&gt;\n    &quot;</span> <span class="o">+</span> <span class="nx">middle</span> <span class="o">+</span> <span class="s2">&quot;\n  &quot;</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">+</span> <span class="s2">&quot;\n&lt;/div&gt;\n&quot;</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">docHtml</span> <span class="o">=</span> <span class="s2">&quot;\n&lt;div class=\&quot;pilwrap\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n  &lt;a class=\&quot;pilcrow\&quot; href=\&quot;#section-&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot; id=\&quot;section-&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;&amp;#182;&lt;/a&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&lt;/div&gt;\n&quot;</span> <span class="o">+</span> <span class="nx">docHtml</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">docHtml</span><span class="p">;</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## renderCodeHtml</p>

<p>Given an array of sections, render them all out to a nice HTML file</p>

<p>@param {Array} sections Array of sections containing parsed data
  @param {string} filename Name of the file being processed
  @param {function} cb Callback function to fire when we're done</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderCodeHtml</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">headings</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">levels</span><span class="p">,</span> <span class="nx">outDir</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">pathSeparator</span><span class="p">,</span> <span class="nx">relDir</span><span class="p">,</span> <span class="nx">relativeOut</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span>
      <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
    <span class="nx">headings</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">outFile</span><span class="p">);</span>
    <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nx">relativeOut</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">outDir</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nx">levels</span> <span class="o">=</span> <span class="p">(</span><span class="nx">relativeOut</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">relativeOut</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
    <span class="nx">relDir</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">);</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">section</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
      <span class="nx">section</span><span class="p">.</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">docHtml</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">headings</span><span class="p">);</span>
      <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
      <span class="nx">sections</span><span class="o">:</span> <span class="nx">sections</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">renderedCode</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">locals</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">locals</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
        <span class="nx">relativeDir</span><span class="o">:</span> <span class="nx">relDir</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="nx">renderedCode</span><span class="p">,</span>
        <span class="nx">headings</span><span class="o">:</span> <span class="nx">headings</span><span class="p">,</span>
        <span class="nx">sidebar</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">,</span>
        <span class="nx">colourScheme</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">,</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;tmpl&quot;</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">outFile</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">,</span> <span class="s2">&quot;Generated: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">outFile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## renderMarkdownHtml</p>

<p>Renders the output for a Markdown file into HTML</p>

<p>@param {string} content The markdown file content
  @param {string} filename Name of the file being processed
  @param {function} cb Callback function to fire when we're done</p></div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_renderMarkdown</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">headings</span><span class="p">,</span> <span class="nx">levels</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="nx">outDir</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">pathSeparator</span><span class="p">,</span> <span class="nx">relDir</span><span class="p">,</span> <span class="nx">relativeOut</span><span class="p">;</span>
      <span class="nx">headings</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;&lt;div class=\&quot;docs markdown\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">headings</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
      <span class="nx">outFile</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
      <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">outFile</span><span class="p">);</span>
      <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">relativeOut</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">outDir</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">levels</span> <span class="o">=</span> <span class="p">(</span><span class="nx">relativeOut</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">relativeOut</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">relDir</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">);</span>
      <span class="nx">locals</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
        <span class="nx">relativeDir</span><span class="o">:</span> <span class="nx">relDir</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
        <span class="nx">headings</span><span class="o">:</span> <span class="nx">headings</span><span class="p">,</span>
        <span class="nx">colourScheme</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">,</span>
        <span class="nx">sidebar</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">,</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\\\/]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;tmpl&quot;</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">outFile</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">,</span> <span class="s2">&quot;Generated: &quot;</span> <span class="o">+</span> <span class="nx">outFile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
  ## copySharedResources</p>

<p>Copies the shared CSS and JS files to the output directories</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">copySharedResources</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">inPath_colorSchemeCSS</span><span class="p">,</span> <span class="nx">inPath_scriptJS</span><span class="p">,</span> <span class="nx">log</span><span class="p">,</span> <span class="nx">outPath_CSS</span><span class="p">,</span> <span class="nx">outPath_docScriptJS</span><span class="p">,</span> <span class="nx">outPath_filelistJS</span><span class="p">,</span> <span class="nx">outPath_indexHTML</span><span class="p">,</span>
      <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">inPath_scriptJS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;script.js&quot;</span><span class="p">);</span>
    <span class="nx">inPath_colorSchemeCSS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s2">&quot;.css&quot;</span><span class="p">);</span>
    <span class="nx">outPath_docScriptJS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;doc-script.js&quot;</span><span class="p">);</span>
    <span class="nx">outPath_filelistJS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;doc-filelist.js&quot;</span><span class="p">);</span>
    <span class="nx">outPath_CSS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;doc-style.css&quot;</span><span class="p">);</span>
    <span class="nx">outPath_indexHTML</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span><span class="p">);</span>
    <span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;async&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">async</span><span class="p">.</span><span class="nx">auto</span><span class="p">({</span>
      <span class="nx">readScriptJS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">inPath_scriptJS</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">readColorschemeCSS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">inPath_colorSchemeCSS</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">genPygmentsCSS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;pygmentize -S &quot;</span> <span class="o">+</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s2">&quot; -f html -a &#39;body .highlight&#39;&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">stderr</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="nx">readUserCSS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">async</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">css</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">mapCb</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span> <span class="nx">mapCb</span><span class="p">);</span>
        <span class="p">}),</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">renderIndexPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">index</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">destination</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
          <span class="p">},</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">writeIndexPage</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;renderIndexPage&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">index</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_indexHTML</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">renderIndexPage</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nx">writeFilelistJS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_filelistJS</span><span class="p">,</span> <span class="s2">&quot;var tree=&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">tree</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Saved file tree to doc-filelist.js&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="nx">writeScriptJS</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;readScriptJS&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_docScriptJS</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">readScriptJS</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Copied JS to doc-script.js&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nx">concatCSS</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;readColorschemeCSS&quot;</span><span class="p">,</span> <span class="s2">&quot;genPygmentsCSS&quot;</span><span class="p">,</span> <span class="s2">&quot;readUserCSS&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">readColorschemeCSS</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">results</span><span class="p">.</span><span class="nx">genPygmentsCSS</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">results</span><span class="p">.</span><span class="nx">readUserCSS</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nx">writeAllCSS</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;concatCSS&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_CSS</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">concatCSS</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Copied all CSS to doc-style.css&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">finished</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">outFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tplName</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rendered</span><span class="p">,</span> <span class="nx">templatePath</span><span class="p">,</span> <span class="nx">tplFn</span><span class="p">;</span>
    <span class="nx">templatePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tplDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">tplName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">tplExtension</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tplEngine</span> <span class="o">===</span> <span class="s2">&quot;internal&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">tplFn</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">templatePath</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
      <span class="nx">rendered</span> <span class="o">=</span> <span class="nx">tplFn</span><span class="p">(</span><span class="nx">locals</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">consolidate</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">tplEngine</span><span class="p">](</span><span class="nx">templatePath</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compileTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span> <span class="s2">&quot;var p=[],print=function(){p.push.apply(p,arguments);};&quot;</span> <span class="o">+</span> <span class="s2">&quot;with(obj){p.push(&#39;&quot;</span> <span class="o">+</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\r\t]/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&gt;)\s*\n+(\s*&lt;)/g</span><span class="p">,</span> <span class="s2">&quot;$1\n$2&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?=&lt;%[^=][^%]*)%&gt;\s*\n*\s*&lt;%(?=[^=])/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%&gt;\s*(?=\n)/g</span><span class="p">,</span> <span class="s2">&quot;%&gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?=\n)\s*&lt;%/g</span><span class="p">,</span> <span class="s2">&quot;&lt;%&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s2">&quot;~K&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/~K(?=[^%]*%&gt;)/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/~K/g</span><span class="p">,</span> <span class="s2">&quot;\\n&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;(?=[^%]*%&gt;)/g</span><span class="p">,</span> <span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%=(.+?)%&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&#39;,$1,&#39;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&lt;%&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;);&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;%&gt;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;p.push(&#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;);}return p.join(&#39;&#39;);&quot;</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">doneLog</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">outDir</span><span class="p">;</span>
    <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">outDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">doneLog</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doneLog</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">doneCallback</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">outDir</span><span class="p">;</span>
    <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nx">fileContent</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">outDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">Otis</span><span class="p">;</span>

<span class="p">})();</span>
</pre></div></td></tr></tbody></table></div></body></html>