#!/usr/bin/env node

// Generated by CoffeeScript 1.3.3
var Docker, booleanish, color, d, field, fields, fs, localJSConfig, opts, path, program, pwd, watchr, _i, _j, _len, _len1, _localConfig, _ref, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9;

path = require("path");

program = require("commander");

watchr = require("watchr");

fs = require("fs");

Docker = require("docker").Docker;

try {
  require("colors");
} catch (e) {
  _ref = ["red", "green", "grey", "magenta", "bold", "underline", "blue", "cyan", "yellow"];
  for (_i = 0, _len = _ref.length; _i < _len; _i++) {
    color = _ref[_i];
    String.prototype.__defineGetter__(color, function() {
      return this.toString();
    });
  }
}

pwd = path.resolve(".");

localJSConfig = ((function() {
  try {
    _localConfig = require(path.join(pwd, "docker.config.js"));
    console.log("Using docker.config.js config file in PWD");
    return _localConfig;
  } catch (err) {
    console.log("err!", err);
    return {};
  }
})());

program.version("0.1.5").option("-i, --inDir [dir]", "Input directory (defaults to current dir)", (_ref8 = localJSConfig.inDir) != null ? _ref8 : pwd).option("-o, --outDir [dir]", "Output directory (defaults to ./doc)", (_ref7 = localJSConfig.outDir) != null ? _ref7 : path.join(pwd, "doc")).option("-t, --tplDir [dir]", "Directory containing dox.<ext>, code.<ext>, and tmpl.<ext>", (_ref6 = localJSConfig.tplDir) != null ? _ref6 : path.join(__dirname, "..", "res")).option("-e, --tplEngine [x]", "Template parser (see github.com/visionmedia/consolidate.js)", (_ref5 = localJSConfig.tplEngine) != null ? _ref5 : "internal").option("-n, --tplExtension [ext]", "Template file extension ", (_ref4 = localJSConfig.tplExtension) != null ? _ref4 : "jst").option("-m, --markdownEngine [gfm | marked]", "Only two choices, cowboy.", (_ref3 = localJSConfig.markdownEngine) != null ? _ref3 : "marked").option("-u, --onlyUpdated", "Only process files that have been changed", localJSConfig.onlyUpdated).option("-c, --colourScheme [style]", "Colour scheme to use (as in pygmentize -L styles)", localJSConfig.colourScheme).option("-w, --watch", "Watch on the input directory for file changes (experimental)", localJSConfig.watch).option("-I, --ignoreHidden", "Ignore hidden files and directories (starting with . or _)", localJSConfig.ignoreHidden).option("-s, --sidebarState [state]", "Whether the sidebar should be open or not by default", (_ref2 = localJSConfig.sidebarState) != null ? _ref2 : "yes").option("-x, --exclude [pattern]", "Paths to exclude", (_ref1 = localJSConfig.exclude) != null ? _ref1 : false).parse(process.argv);

booleanish = function(input) {
  if (input === true || input === false) {
    return input;
  }
  if (typeof input === "number" || (+input + "" === input + "")) {
    return !!+input;
  }
  input = input.toString();
  if (input === "") {
    return true;
  } else {
    return /(y(es)?|ok|t(rue)?)/i.test(input);
  }
};

fields = ["inDir", "outDir", "tplDir", "tplEngine", "tplExtension", "markdownEngine", "onlyUpdated", "colourScheme", "ignoreHidden", "sidebarState", "exclude"];

console.log("Options:".white.bold);

opts = {};

for (_j = 0, _len1 = fields.length; _j < _len1; _j++) {
  field = fields[_j];
  opts[field] = program[field];
  console.log(field.red + ": ".white + ((_ref9 = opts[field]) != null ? _ref9 : "-").grey);
}

d = new Docker(opts);

if (program.args.length === 0) {
  program.args = ["./"];
}

if (program.watch) {
  d.watch(program.args);
} else {
  d.doc(program.args);
}
