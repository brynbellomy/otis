<!DOCTYPE html><html><head><title>otis.js</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="../doc-style.css"><script src="../doc-filelist.js"></script><script>var relativeDir = '../', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="../doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"><div class="heading h1"><a href="#otis.js">otis.js</a></div></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"></td><td class="code highlight"></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
</td><td class="code highlight"><div class="highlight"><pre><span class="c1">// Generated by CoffeeScript 1.4.0</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="otis.js">
  <h1>
    <a href="#otis.js" class="pilcrow">&#182;</a>
    otis.js
  </h1>
</div>
</div><div class="body"><p>A highly customizable, extremely simple documentation generator based on</p>


<ul>
<li><a href="http://jashkenas.github.com/docco/">jashkenas / <strong>docco</strong></a></li>
<li><a href="https://github.com/mbrevoort/docco-husky">mbrevoort / <strong>docco-husky</strong></a></li>
<li><a href="http://jbt.github.com/docker">jbt / <strong>docker</strong></a></li>
</ul>


<p><strong>otis</strong> was once a really simple documentation generator -- <strong>docker</strong>.  <strong>docker</strong> originally
started out as a pure-javascript port of <strong>docco</strong>, but eventually gained many extra little features
that somewhat break docco's philosophy of being a quick-and-dirty thing.</p>

<p><strong>docker</strong> was based on <strong>docco</strong>'s coffeescript source, but converted to javascript.</p>

<p><strong>otis</strong> is based on <strong>docker</strong>, but has been re-converted to coffeescript.</p>

<p>especially given that some of the conversion was made using the fantastic (but not infallible)
(<a href='http://js2coffee.org'>http://js2coffee.org</a>), you might notice some strange code artifacts here and there -- javascript-isms
converted into coffeescript, and coffeescript-isms converted <em>through</em> javascript back into itself.</p>

<p>otis source code can be found on GitHub at <a href="https://github.com/brynbellomy/otis">brynbellomy / otis</a></p>

<p>By the way, this page is the result of running otis against itself (with some additional custom CSS appended).</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">consolidate</span><span class="p">,</span> <span class="nx">dox</span><span class="p">,</span> <span class="nx">exec</span><span class="p">,</span> <span class="nx">fs</span><span class="p">,</span> <span class="nx">mkdirp</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">spawn</span><span class="p">,</span> <span class="nx">watchr</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span>
    <span class="nx">__bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">me</span><span class="p">){</span> <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="p">};</span> <span class="p">};</span>

  <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>

  <span class="nx">dox</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dox&quot;</span><span class="p">);</span>

  <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">);</span>

  <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;child_process&quot;</span><span class="p">),</span> <span class="nx">exec</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">exec</span><span class="p">,</span> <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">spawn</span><span class="p">;</span>

  <span class="nx">watchr</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;watchr&quot;</span><span class="p">);</span>

  <span class="nx">mkdirp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mkdirp&quot;</span><span class="p">);</span>

  <span class="nx">consolidate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;consolidate&quot;</span><span class="p">);</span>

  <span class="nx">exports</span><span class="p">.</span><span class="nx">Otis</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## Otis()</p>


<div class="highlight"><pre><code><span class="n">Creates</span> <span class="n">a</span> <span class="n">new</span> <span class="n">otis</span> <span class="n">instance</span><span class="p">.</span> <span class="n">All</span> <span class="k">methods</span> <span class="n">are</span> <span class="n">called</span> <span class="n">on</span> <span class="n">one</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">this</span> <span class="n">object</span><span class="p">.</span>

<span class="n">Input</span> <span class="n">arguments</span> <span class="n">are</span> <span class="n">an</span> <span class="n">object</span> <span class="n">containing</span> <span class="n">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">keys</span>

<span class="o">-</span> `<span class="n">inDir</span>`
<span class="o">-</span> `<span class="n">outDir</span>`
<span class="o">-</span> `<span class="n">tplDir</span>`<span class="p">,</span>
<span class="o">-</span> `<span class="n">tplEngine</span>`
<span class="o">-</span> `<span class="n">tplExtension</span>`
<span class="o">-</span> `<span class="n">markdownEngine</span>`
<span class="o">-</span> `<span class="n">colorScheme</span>`
<span class="o">-</span> `<span class="n">css</span>`
<span class="o">-</span> `<span class="n">index</span>`
<span class="o">-</span> `<span class="n">tolerant</span>`
<span class="o">-</span> `<span class="n">delimStart</span>`
<span class="o">-</span> `<span class="n">delimEnd</span>`
<span class="o">-</span> `<span class="n">onlyUpdated</span>`
<span class="o">-</span> `<span class="n">ignoreHidden</span>`
<span class="o">-</span> `<span class="n">sidebarState</span>`
<span class="o">-</span> `<span class="n">exclude</span>`

<span class="p">@</span><span class="n">constructor</span>
<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">object</span><span class="p">}</span> <span class="n">opts</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">Otis</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">renderCodeHtml</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderCodeHtml</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">highlightExtractedCode</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlightExtractedCode</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlight</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">pygments</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pygments</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">languageParams</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languageParams</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">parseSections</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseSections</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">addFileToTree</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addFileToTree</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">queueFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queueFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">clean</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">finished</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">watch</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watch</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span> <span class="o">=</span> <span class="nx">__bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parseOpts</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseOpts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">_fn</span><span class="p">,</span>
        <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">inDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
        <span class="nx">outDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;doc&quot;</span><span class="p">),</span>
        <span class="nx">tplDir</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span> <span class="s2">&quot;res&quot;</span><span class="p">),</span>
        <span class="nx">tplEngine</span><span class="o">:</span> <span class="s2">&quot;internal&quot;</span><span class="p">,</span>
        <span class="nx">tplExtension</span><span class="o">:</span> <span class="s2">&quot;jst&quot;</span><span class="p">,</span>
        <span class="nx">markdownEngine</span><span class="o">:</span> <span class="s2">&quot;marked&quot;</span><span class="p">,</span>
        <span class="nx">colourScheme</span><span class="o">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="nx">css</span><span class="o">:</span> <span class="p">[],</span>
        <span class="nx">index</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">tolerant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">delimStart</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">delimEnd</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">onlyUpdated</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">ignoreHidden</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">sidebarState</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">exclude</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">};</span>
      <span class="nx">_fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">defaults</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_fn</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">inDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">inDir</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">outDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">outDir</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tplDir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">tplDir</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tplEngine</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">tplEngine</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tplExtension</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">tplExtension</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">markdownEngine</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">markdownEngine</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">css</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">css</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">tolerant</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">delimStart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">delimStart</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">delimStart</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">delimEnd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">delimEnd</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">delimEnd</span><span class="p">)</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">ignoreHidden</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">ignoreHidden</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sidebarState</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">exclude</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^(&quot;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">exclude</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span> <span class="s2">&quot;\\.&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\*/g</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)(/|$)&quot;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colorScheme</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">opts</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colorScheme</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_renderMarkdown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fn</span><span class="p">;</span>
        <span class="nx">fn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">markdownEngine</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s2">&quot;gfm&quot;</span><span class="o">:</span>
            <span class="nx">fn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;github-flavored-markdown&quot;</span><span class="p">).</span><span class="nx">parse</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="s2">&quot;showdown&quot;</span><span class="o">:</span>
            <span class="nx">fn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/../res/showdown&quot;</span><span class="p">).</span><span class="nx">Showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="s2">&quot;marked&quot;</span><span class="o">:</span>
            <span class="nx">fn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;marked&quot;</span><span class="p">);</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span>
              <span class="nx">gfm</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="nx">pedantic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="nx">sanitize</span><span class="o">:</span> <span class="kc">false</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">default</span><span class="o">:</span>
            <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## doc</p>


<div class="highlight"><pre><code><span class="n">Generates</span> <span class="n">documentation</span> <span class="k">for</span> <span class="n">specified</span> <span class="n">files</span><span class="p">.</span>

<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">Array</span><span class="p">}</span> <span class="n">files</span> <span class="n">Array</span> <span class="n">of</span> <span class="n">file</span> <span class="n">paths</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">the</span> `<span class="n">inDir</span>` <span class="n">to</span> <span class="n">generate</span> <span class="n">documentation</span> <span class="k">for</span><span class="p">.</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">[].</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">,</span> <span class="nx">files</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## watch</p>


<div class="highlight"><pre><code><span class="n">Watches</span> <span class="n">the</span> <span class="n">input</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">file</span> <span class="n">changes</span> <span class="n">and</span> <span class="n">updates</span> <span class="n">docs</span> <span class="n">whenever</span> <span class="n">a</span> <span class="n">file</span> <span class="n">is</span> <span class="n">updated</span>

<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">Array</span><span class="p">}</span> <span class="n">files</span> <span class="n">Array</span> <span class="n">of</span> <span class="n">file</span> <span class="n">paths</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">the</span> `<span class="n">inDir</span>` <span class="n">to</span> <span class="n">generate</span> <span class="n">documentation</span> <span class="k">for</span><span class="p">.</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">watch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">uto</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">watching</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span> <span class="o">=</span> <span class="nx">files</span><span class="p">;</span>
      <span class="nx">uto</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span><span class="nx">uto</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">250</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">clean</span><span class="p">();</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">uto</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">watchr</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uto</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">uto</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}),</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## finished</p>


<div class="highlight"><pre><code><span class="nx">Callback</span> <span class="kd">function</span> <span class="nx">fired</span> <span class="nx">when</span> <span class="nx">processing</span> <span class="nx">is</span> <span class="nx">finished</span><span class="p">.</span>
</code></pre></div>

</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">red</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watching</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Done. Waiting for changes...&quot;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Done.&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## clean</p>


<div class="highlight"><pre><code><span class="n">Clears</span> <span class="n">out</span> <span class="n">any</span> <span class="n">instance</span> <span class="n">variables</span> <span class="n">so</span> <span class="n">this</span> <span class="n">otis</span> <span class="n">can</span> <span class="n">be</span> <span class="n">rerun</span>
</code></pre></div>

</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## addNextFile</p>


<div class="highlight"><pre><code><span class="n">Process</span> <span class="n">the</span> <span class="n">next</span> <span class="n">file</span> <span class="n">on</span> <span class="n">the</span> <span class="n">scan</span> <span class="n">queue</span><span class="p">.</span> <span class="n">If</span> <span class="n">it</span><span class="o">&#39;</span><span class="n">s</span> <span class="n">a</span> <span class="n">directory</span><span class="p">,</span> <span class="n">list</span> <span class="n">all</span> <span class="n">the</span> <span class="n">children</span> <span class="n">and</span> <span class="n">queue</span> <span class="n">those</span><span class="p">.</span>
<span class="n">If</span> <span class="n">it</span><span class="o">&#39;</span><span class="n">s</span> <span class="n">a</span> <span class="n">file</span><span class="p">,</span> <span class="n">add</span> <span class="n">it</span> <span class="n">to</span> <span class="n">the</span> <span class="n">queue</span><span class="p">.</span>
</code></pre></div>

</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addNextFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">currFile</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">filename</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">excludePattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">filename</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">currFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>
        <span class="nx">cb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readlink</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">currFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">currFile</span><span class="p">),</span> <span class="nx">link</span><span class="p">);</span>
              <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unable to follow symlink to &quot;</span> <span class="o">+</span> <span class="nx">currFile</span> <span class="o">+</span> <span class="s2">&quot;: file does not exist&quot;</span><span class="p">);</span>
                  <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
                <span class="p">}</span>
              <span class="p">});</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">maybe</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
              <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">maybe</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">ignoreHidden</span> <span class="o">&amp;&amp;</span> <span class="nx">maybe</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[\._]/</span><span class="p">))</span> <span class="p">{</span>
                  <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">scanQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">maybe</span><span class="p">));</span>
              <span class="p">}</span>
              <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">queueFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addNextFile</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">currFile</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## queueFile</p>


<div class="highlight"><pre><code><span class="n">Queues</span> <span class="n">a</span> <span class="n">file</span> <span class="k">for</span> <span class="n">processing</span><span class="p">,</span> <span class="n">and</span> <span class="n">additionally</span> <span class="n">stores</span> <span class="n">it</span> <span class="n">in</span> <span class="n">the</span> <span class="n">folder</span> <span class="n">tree</span>

<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">string</span><span class="p">}</span> <span class="n">filename</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span> <span class="n">to</span> <span class="n">queue</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">queueFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## addFileToTree</p>


<div class="highlight"><pre><code><span class="n">Adds</span> <span class="n">a</span> <span class="n">file</span> <span class="n">to</span> <span class="n">the</span> <span class="n">file</span> <span class="n">tree</span> <span class="n">to</span> <span class="n">show</span> <span class="n">in</span> <span class="n">the</span> <span class="n">sidebar</span><span class="p">.</span> <span class="n">This</span> <span class="n">used</span> <span class="n">to</span> <span class="n">be</span> <span class="n">in</span> `<span class="n">queueFile</span>` <span class="n">but</span>
<span class="n">since</span> <span class="n">we</span><span class="o">&#39;</span><span class="n">re</span> <span class="n">now</span> <span class="n">only</span> <span class="n">deciding</span> <span class="n">whether</span> <span class="n">or</span> <span class="n">not</span> <span class="n">the</span> <span class="n">file</span> <span class="n">can</span> <span class="n">be</span> <span class="n">included</span> <span class="n">at</span> <span class="n">the</span> <span class="n">point</span> <span class="n">of</span>
<span class="n">reading</span> <span class="n">it</span><span class="p">,</span> <span class="n">this</span> <span class="n">has</span> <span class="n">to</span> <span class="n">happen</span> <span class="n">later</span><span class="p">.</span>

<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">string</span><span class="p">}</span> <span class="n">filename</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">file</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">the</span> <span class="n">tree</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addFileToTree</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">currDir</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">pathSeparator</span><span class="p">;</span>
      <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">filename</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="nx">pathSeparator</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([\/\\])/g</span><span class="p">,</span> <span class="s2">&quot;\\$1&quot;</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">bits</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">);</span>
      <span class="nx">currDir</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tree</span><span class="p">;</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
          <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>
        <span class="nx">currDir</span> <span class="o">=</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
        <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">currDir</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">bits</span><span class="p">[</span><span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## processNextFile</p>


<div class="highlight"><pre><code><span class="n">Take</span> <span class="n">the</span> <span class="n">next</span> <span class="n">file</span> <span class="n">off</span> <span class="n">the</span> <span class="n">queue</span> <span class="n">and</span> <span class="n">process</span> <span class="n">it</span>
</code></pre></div>

</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processNextFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateDoc</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">processNextFile</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">copySharedResources</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## generateDoc</p>


<div class="highlight"><pre><code><span class="nx">_This</span> <span class="nx">is</span> <span class="nx">where</span> <span class="nx">the</span> <span class="nx">magic</span> <span class="nx">happens_</span>

<span class="nx">Generate</span> <span class="nx">the</span> <span class="nx">documentation</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">file</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">filename</span> <span class="nx">File</span> <span class="nx">name</span> <span class="nx">to</span> <span class="nx">generate</span> <span class="nx">documentation</span> <span class="k">for</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">execute</span> <span class="nx">when</span> <span class="nx">we</span><span class="err">&#39;</span><span class="nx">re</span> <span class="nx">done</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateDoc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">infilename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filename</span><span class="p">,</span>
        <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">filename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="nx">infilename</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">shouldProcess</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shouldProcess</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">sections</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">lang</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">languageParams</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">_this</span><span class="p">.</span><span class="nx">addFileToTree</span><span class="p">(</span><span class="nx">infilename</span><span class="p">);</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">lang</span><span class="p">].</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s2">&quot;markdown&quot;</span><span class="o">:</span>
              <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
            <span class="k">case</span> <span class="s2">&quot;code&quot;</span><span class="o">:</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
              <span class="nx">sections</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">parseSections</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">lang</span><span class="p">);</span>
              <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">highlight</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">renderCodeHtml</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
              <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## decideWhetherToProcess</p>


<div class="highlight"><pre><code><span class="nx">Decide</span> <span class="nx">whether</span> <span class="nx">or</span> <span class="nx">not</span> <span class="nx">a</span> <span class="nx">file</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">processed</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> <span class="err">`</span><span class="nx">onlyUpdated</span><span class="err">`</span>
<span class="nx">flag</span> <span class="nx">was</span> <span class="nx">set</span> <span class="nx">on</span> <span class="nx">initialization</span><span class="p">,</span> <span class="nx">only</span> <span class="nx">allow</span> <span class="nx">processing</span> <span class="nx">of</span> <span class="nx">files</span> <span class="nx">that</span>
<span class="nx">are</span> <span class="nx">newer</span> <span class="nx">than</span> <span class="nx">their</span> <span class="nx">counterpart</span> <span class="nx">generated</span> <span class="nx">doc</span> <span class="nx">file</span><span class="p">.</span>

<span class="nx">Fires</span> <span class="nx">a</span> <span class="nx">callback</span> <span class="kd">function</span> <span class="kd">with</span> <span class="nx">either</span> <span class="kc">true</span> <span class="nx">or</span> <span class="kc">false</span> <span class="nx">depending</span> <span class="nx">on</span> <span class="nx">whether</span>
<span class="nx">or</span> <span class="nx">not</span> <span class="nx">the</span> <span class="nx">file</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">processed</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">filename</span> <span class="nx">The</span> <span class="nx">name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">file</span> <span class="nx">to</span> <span class="nx">check</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">callback</span> <span class="nx">Callback</span> <span class="kd">function</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">decideWhetherToProcess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">outFile</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fileIsNewer</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## fileIsNewer</p>


<div class="highlight"><pre><code><span class="nx">Sees</span> <span class="nx">whether</span> <span class="nx">one</span> <span class="nx">file</span> <span class="nx">is</span> <span class="nx">newer</span> <span class="nx">than</span> <span class="nx">another</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">file</span> <span class="nx">File</span> <span class="nx">to</span> <span class="nx">check</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">otherFile</span> <span class="nx">File</span> <span class="nx">to</span> <span class="nx">compare</span> <span class="nx">to</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">callback</span> <span class="nx">Callback</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="kd">with</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">file</span> <span class="nx">is</span> <span class="nx">newer</span> <span class="nx">than</span> <span class="nx">otherFile</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fileIsNewer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">otherFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">otherFile</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">outStat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="s2">&quot;ENOENT&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">inStat</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="o">+</span><span class="nx">inStat</span><span class="p">.</span><span class="nx">mtime</span> <span class="o">&gt;</span> <span class="o">+</span><span class="nx">outStat</span><span class="p">.</span><span class="nx">mtime</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## parseSections</p>


<div class="highlight"><pre><code><span class="n">Parse</span> <span class="n">the</span> <span class="n">content</span> <span class="n">of</span> <span class="n">a</span> <span class="n">file</span> <span class="n">into</span> <span class="n">individual</span> <span class="n">sections</span><span class="p">.</span>
<span class="n">A</span> <span class="n">section</span> <span class="n">is</span> <span class="n">defined</span> <span class="n">to</span> <span class="n">be</span> <span class="n">one</span> <span class="n">block</span> <span class="n">of</span> <span class="n">code</span> <span class="n">with</span> <span class="n">an</span> <span class="n">accompanying</span> <span class="n">comment</span>

<span class="n">Returns</span> <span class="n">an</span> <span class="n">array</span> <span class="n">of</span> <span class="n">section</span> <span class="n">objects</span><span class="p">,</span> <span class="n">which</span> <span class="n">take</span> <span class="n">the</span> <span class="n">form</span>
```<span class="n">js</span>
<span class="p">{</span>
<span class="n">doc_text</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="n">String</span> <span class="n">containing</span> <span class="n">comment</span> <span class="n">content</span>
<span class="n">code_text</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span> <span class="o">//</span> <span class="n">Accompanying</span> <span class="n">code</span>
<span class="p">}</span>
```
<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">string</span><span class="p">}</span> <span class="n">data</span> <span class="n">The</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">the</span> <span class="n">script</span> <span class="n">file</span>
<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">string</span><span class="p">}</span> <span class="n">language</span> <span class="n">The</span> <span class="n">language</span> <span class="n">of</span> <span class="n">the</span> <span class="n">script</span> <span class="n">file</span>

<span class="p">@</span><span class="k">return</span> <span class="p">{</span><span class="n">Array</span><span class="p">}</span> <span class="n">array</span> <span class="n">of</span> <span class="n">section</span> <span class="n">objects</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseSections</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">codeLines</span><span class="p">,</span> <span class="nx">commentRegex</span><span class="p">,</span> <span class="nx">doxData</span><span class="p">,</span> <span class="nx">inMultiLineComment</span><span class="p">,</span> <span class="nx">md</span><span class="p">,</span> <span class="nx">multiLine</span><span class="p">,</span> <span class="nx">multilineDelims</span><span class="p">,</span> <span class="nx">numSpacesIndent</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">_ref1</span><span class="p">,</span> <span class="nx">_ref2</span><span class="p">,</span> <span class="nx">_ref3</span><span class="p">,</span> <span class="nx">_ref4</span><span class="p">,</span> <span class="nx">_ref5</span><span class="p">,</span> <span class="nx">_ref6</span><span class="p">,</span>
        <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">md</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">stripParas</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
        <span class="nx">h</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">_renderMarkdown</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^\s*|\s*$)/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">stripParas</span> <span class="o">?</span> <span class="nx">h</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/?p&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">h</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">codeLines</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
      <span class="nx">sections</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">];</span>
      <span class="nx">multilineDelims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">start</span><span class="o">:</span> <span class="p">(</span><span class="nx">_ref1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">delimStart</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref1</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_ref2</span> <span class="o">=</span> <span class="nx">params</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref3</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref2</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">end</span><span class="o">:</span> <span class="p">(</span><span class="nx">_ref4</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">delimEnd</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref4</span> <span class="o">:</span> <span class="p">(</span><span class="nx">_ref5</span> <span class="o">=</span> <span class="nx">params</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="p">(</span><span class="nx">_ref6</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">multiLine</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref5</span> <span class="o">:</span> <span class="kc">null</span>
      <span class="p">};</span>
      <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">docs</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">code</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">};</span>
      <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">numSpacesIndent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">multiLine</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="nx">doxData</span> <span class="o">=</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">commentRegex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\s*&quot;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s2">&quot;\\s?&quot;</span><span class="p">);</span>
      <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;async&quot;</span><span class="p">);</span>
      <span class="nx">async</span><span class="p">.</span><span class="nx">forEachSeries</span><span class="p">(</span><span class="nx">codeLines</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">,</span> <span class="nx">forEachCb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">matchable</span><span class="p">;</span>
        <span class="nx">matchable</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([&quot;&#39;])(?:\\.|(?!\1).)*\1/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">end</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">inMultiLineComment</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">end</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">dox</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">;</span>
                <span class="k">try</span> <span class="p">{</span>
                  <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">multiLine</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                  <span class="p">}</span>
                  <span class="nx">multiLine</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;/**&quot;</span> <span class="o">+</span> <span class="nx">multiLine</span> <span class="o">+</span> <span class="s2">&quot;*/&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^ {&quot;</span> <span class="o">+</span> <span class="nx">numSpacesIndent</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                  <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
                  <span class="nx">doxData</span> <span class="o">=</span> <span class="nx">dox</span><span class="p">.</span><span class="nx">parseComments</span><span class="p">(</span><span class="nx">multiLine</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">raw</span><span class="o">:</span> <span class="kc">true</span>
                  <span class="p">})[</span><span class="mi">0</span><span class="p">];</span>
                  <span class="nx">doxData</span><span class="p">.</span><span class="nx">md</span> <span class="o">=</span> <span class="nx">md</span><span class="p">;</span>
                  <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;dox&quot;</span><span class="p">,</span> <span class="nx">doxData</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="nx">rendered</span><span class="p">;</span>
                    <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
                  <span class="p">});</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Dox error: &quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
                  <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
                  <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
                <span class="p">}</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
                <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">multiLine</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="nx">multiLine</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">multiLine</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">_this</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">docs</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="nx">code</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
              <span class="p">};</span>
            <span class="p">}</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">multilineDelims</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
              <span class="nx">numSpacesIndent</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">inMultiLineComment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">multiLine</span> <span class="o">=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span> <span class="o">||</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">matchable</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/#!/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">matchable</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">section</span> <span class="o">=</span> <span class="p">{</span>
              <span class="nx">docs</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="nx">code</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
            <span class="p">};</span>
          <span class="p">}</span>
          <span class="nx">line</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">commentRegex</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">line</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">docs</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span> <span class="o">||</span> <span class="o">!</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">commentsIgnore</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">section</span><span class="p">.</span><span class="nx">code</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">forEachCb</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">sections</span><span class="p">;</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## languageParams</p>


<div class="highlight"><pre><code><span class="n">Provides</span> <span class="n">language</span><span class="o">-</span><span class="n">specific</span> <span class="n">params</span> <span class="k">for</span> <span class="n">a</span> <span class="n">given</span> <span class="n">file</span> <span class="n">name</span><span class="p">.</span>

<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">string</span><span class="p">}</span> <span class="n">filename</span> <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span> <span class="n">to</span> <span class="n">test</span>
<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">string</span><span class="p">}</span> <span class="n">filedata</span> <span class="n">The</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span> <span class="p">(</span><span class="n">to</span> <span class="n">check</span> <span class="k">for</span> <span class="n">shebang</span><span class="p">)</span>
<span class="p">@</span><span class="k">return</span> <span class="p">{</span><span class="n">object</span><span class="p">}</span> <span class="n">Object</span> <span class="n">containing</span> <span class="n">all</span> <span class="n">of</span> <span class="n">the</span> <span class="n">language</span><span class="o">-</span><span class="n">specific</span> <span class="n">params</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languageParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">filedata</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ext</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">shebangRegex</span><span class="p">;</span>
      <span class="nx">ext</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
      <span class="nx">ext</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\./</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ext</span> <span class="o">===</span> <span class="s2">&quot;.C&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;cpp&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">ext</span> <span class="o">=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">shebangRegex</span> <span class="o">=</span> <span class="sr">/^\n*#!\s*(?:\/usr\/bin\/env)?\s*(?:[^\n]*\/)*([^\/\n]+)(?:\n|$)/</span><span class="p">;</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="nx">shebangRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">filedata</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">executables</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">executables</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">j</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    The language params can have the following keys:</p>


<div class="highlight"><pre><code><span class="o">+</span> `<span class="n">name</span>`<span class="p">:</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">Pygments</span> <span class="n">lexer</span> <span class="n">to</span> <span class="n">use</span>
<span class="o">+</span> `<span class="n">comment</span>`<span class="p">:</span> <span class="n">String</span> <span class="n">flag</span> <span class="k">for</span> <span class="n">single</span><span class="o">-</span><span class="n">line</span> <span class="n">comments</span>
<span class="o">+</span> `<span class="n">multiline</span>`<span class="p">:</span> <span class="n">Two</span><span class="o">-</span><span class="n">element</span> <span class="n">array</span> <span class="n">of</span> <span class="n">start</span> <span class="n">and</span> <span class="k">end</span> <span class="n">flags</span> <span class="k">for</span> <span class="n">block</span> <span class="n">comments</span>
<span class="o">+</span> `<span class="n">commentsIgnore</span>`<span class="p">:</span> <span class="n">Regex</span> <span class="n">of</span> <span class="n">comments</span> <span class="n">to</span> <span class="n">strip</span> <span class="n">completely</span> <span class="p">(</span><span class="n">don</span><span class="o">&#39;</span><span class="n">t</span> <span class="n">even</span> <span class="n">doc</span><span class="p">)</span>
<span class="o">+</span> `<span class="n">dox</span>`<span class="p">:</span> <span class="n">Whether</span> <span class="n">to</span> <span class="n">run</span> <span class="n">block</span> <span class="n">comments</span> <span class="n">through</span> <span class="n">Dox</span>
<span class="o">+</span> `<span class="n">type</span>`<span class="p">:</span> <span class="n">Either</span> `<span class="s">&#39;code&#39;</span>` <span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="n">or</span> `<span class="s">&#39;markdown&#39;</span>` <span class="o">-</span> <span class="n">format</span> <span class="n">of</span> <span class="n">page</span> <span class="n">to</span> <span class="n">render</span>
</code></pre></div>

</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languages</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">javascript</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;js&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">],</span>
        <span class="nx">commentsIgnore</span><span class="o">:</span> <span class="sr">/^\s*\/\/=/</span><span class="p">,</span>
        <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="nx">coffeescript</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/^(\s*)###/</span><span class="p">,</span> <span class="sr">/###\s*$/</span><span class="p">],</span>
        <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="nx">ruby</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;rb&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;ruby&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\=begin/</span><span class="p">,</span> <span class="sr">/\=end/</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">python</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;py&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
      <span class="p">},</span>
      <span class="nx">perl</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;pm&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;perl&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
      <span class="p">},</span>
      <span class="nx">c</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;gcc&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">objc</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;clang&quot;</span><span class="p">,</span> <span class="s2">&quot;gcc&quot;</span><span class="p">],</span>
        <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*\*?/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">cpp</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;cpp&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;g++&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">csharp</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;cs&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">java</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;java&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">],</span>
        <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="nx">php</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;php&quot;</span><span class="p">,</span> <span class="s2">&quot;php3&quot;</span><span class="p">,</span> <span class="s2">&quot;php4&quot;</span><span class="p">,</span> <span class="s2">&quot;php5&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;php&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">],</span>
        <span class="nx">dox</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="nx">actionscript</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;as&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;//&quot;</span><span class="p">,</span>
        <span class="nx">multiLine</span><span class="o">:</span> <span class="p">[</span><span class="sr">/\/\*/</span><span class="p">,</span> <span class="sr">/\*\//</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">sh</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;sh&quot;</span><span class="p">],</span>
        <span class="nx">executables</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="s2">&quot;zsh&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
      <span class="p">},</span>
      <span class="nx">yaml</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">],</span>
        <span class="nx">comment</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span>
      <span class="p">},</span>
      <span class="nx">markdown</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;md&quot;</span><span class="p">,</span> <span class="s2">&quot;mkd&quot;</span><span class="p">,</span> <span class="s2">&quot;markdown&quot;</span><span class="p">],</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;markdown&quot;</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## pygments</p>


<div class="highlight"><pre><code><span class="nx">Runs</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">block</span> <span class="nx">of</span> <span class="nx">code</span> <span class="nx">through</span> <span class="nx">pygments</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">data</span> <span class="nx">The</span> <span class="nx">code</span> <span class="nx">to</span> <span class="nx">give</span> <span class="nx">to</span> <span class="nx">Pygments</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">language</span> <span class="nx">The</span> <span class="nx">name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Pygments</span> <span class="nx">lexer</span> <span class="nx">to</span> <span class="nx">use</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="kd">with</span> <span class="nx">Pygments</span> <span class="nx">output</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pygments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">pyg</span><span class="p">,</span> <span class="nx">pygArgs</span><span class="p">;</span>
      <span class="nx">pygArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-g&quot;</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pygArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="nx">language</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">pyg</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s2">&quot;pygmentize&quot;</span><span class="p">,</span> <span class="nx">pygArgs</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;-O&quot;</span><span class="p">,</span> <span class="s2">&quot;encoding=utf-8,tabsize=2&quot;</span><span class="p">]));</span>
      <span class="nx">pyg</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
      <span class="p">});</span>
      <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unable to write to Pygments stdin: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">out</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">pyg</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">writable</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">pyg</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## highlight</p>


<div class="highlight"><pre><code><span class="nx">Highlights</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">sections</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">file</span> <span class="nx">using</span> <span class="o">**</span><span class="nx">pygments</span><span class="o">**</span>
<span class="nx">Given</span> <span class="nx">an</span> <span class="nx">array</span> <span class="nx">of</span> <span class="nx">section</span> <span class="nx">objects</span><span class="p">,</span> <span class="nx">loop</span> <span class="nx">through</span> <span class="nx">them</span><span class="p">,</span> <span class="nx">and</span> <span class="k">for</span> <span class="nx">each</span>
<span class="nx">section</span> <span class="nx">generate</span> <span class="nx">pretty</span> <span class="nx">html</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">comments</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">put</span> <span class="nx">them</span> <span class="k">in</span>
<span class="err">`</span><span class="nx">docHtml</span><span class="err">`</span> <span class="nx">and</span> <span class="err">`</span><span class="nx">codeHtml</span><span class="err">`</span> <span class="nx">respectively</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">sections</span> <span class="nb">Array</span> <span class="nx">of</span> <span class="nx">section</span> <span class="nx">objects</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">language</span> <span class="nx">Language</span> <span class="nx">ith</span> <span class="nx">which</span> <span class="nx">to</span> <span class="nx">highlight</span> <span class="nx">the</span> <span class="nx">file</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="nx">when</span> <span class="nx">we</span><span class="err">&#39;</span><span class="nx">re</span> <span class="nx">done</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">input</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span>
        <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">[</span><span class="nx">language</span><span class="p">];</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">code</span><span class="p">);</span>
        <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s2">&quot;----{DIVIDER_THING}----\n&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pygments</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">;</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;&lt;\/div&gt;\s*$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">bits</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\n*&lt;span class=\&quot;c[1p]?\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">comment</span> <span class="o">+</span> <span class="s2">&quot;----\\{DIVIDER_THING\\}----&lt;\\/span&gt;\\n*&quot;</span><span class="p">));</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">++</span><span class="nx">_i</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">section</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">codeHtml</span> <span class="o">=</span> <span class="s2">&quot;&lt;div class=\&quot;highlight\&quot;&gt;&lt;pre&gt;&quot;</span> <span class="o">+</span> <span class="nx">bits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/pre&gt;&lt;/div&gt;&quot;</span><span class="p">;</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">_renderMarkdown</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">);</span>
          <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## processDocCodeBlocks</p>


<div class="highlight"><pre><code><span class="nx">Goes</span> <span class="nx">through</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">HTML</span> <span class="nx">generated</span> <span class="nx">from</span> <span class="nx">comments</span><span class="p">,</span> <span class="nx">finds</span> <span class="nx">any</span> <span class="nx">code</span> <span class="nx">blocks</span>
<span class="nx">and</span> <span class="nx">highlights</span> <span class="nx">them</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">sections</span> <span class="nx">Sections</span> <span class="nx">array</span> <span class="nx">as</span> <span class="nx">above</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="nx">when</span> <span class="nx">done</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processDocCodeBlocks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">next</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">(</span><span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
          <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## extractDocCode</p>


<div class="highlight"><pre><code><span class="nx">Extract</span> <span class="nx">and</span> <span class="nx">highlight</span> <span class="nx">code</span> <span class="nx">blocks</span> <span class="k">in</span> <span class="nx">formatted</span> <span class="nx">HTML</span> <span class="nx">output</span> <span class="nx">from</span> <span class="nx">showdown</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">html</span> <span class="nx">The</span> <span class="nx">HTML</span> <span class="nx">to</span> <span class="nx">process</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="nx">when</span> <span class="nx">done</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extractDocCode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">codeBlocks</span><span class="p">;</span>
      <span class="nx">codeBlocks</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;pre&gt;&lt;code(\slanguage=&#39;([a-z]*)&#39;)?&gt;([^&lt;]*)&lt;\/code&gt;&lt;\/pre&gt;/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wholeMatch</span><span class="p">,</span> <span class="nx">langBlock</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">langBlock</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">language</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="s2">&quot;&lt;div class=&#39;highlight&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">wholeMatch</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">block</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;gt;/g</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;lt;/g</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;amp;/</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">&quot;\n\n~C&quot;</span> <span class="o">+</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">language</span><span class="o">:</span> <span class="nx">language</span><span class="p">,</span>
          <span class="nx">code</span><span class="o">:</span> <span class="nx">block</span><span class="p">,</span>
          <span class="nx">i</span><span class="o">:</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;C\n\n&quot;</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">highlightExtractedCode</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">codeBlocks</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## highlightExtractedCode</p>


<div class="highlight"><pre><code><span class="nx">Loops</span> <span class="nx">through</span> <span class="nx">all</span> <span class="nx">extracted</span> <span class="nx">code</span> <span class="nx">blocks</span> <span class="nx">and</span> <span class="nx">feeds</span> <span class="nx">them</span> <span class="nx">through</span> <span class="nx">pygments</span>
<span class="k">for</span> <span class="nx">code</span> <span class="nx">highlighting</span><span class="p">.</span> <span class="nx">Unfortunately</span> <span class="nx">the</span> <span class="nx">only</span> <span class="nx">way</span> <span class="nx">to</span> <span class="k">do</span> <span class="k">this</span> <span class="nx">that</span><span class="s1">&#39;s able</span>
<span class="s1">to cater for all situations is to spawn a new pygments process for each</span>
<span class="s1">code block (as different blocks might be in different languages). If anyone</span>
<span class="s1">knows of a more efficient way of doing this, please let me know.</span>

<span class="s1">@param {string} html The HTML the code has been extracted from</span>
<span class="s1">@param {Array} codeBlocks Array of extracted code blocks as above</span>
<span class="s1">@param {function} cb Callback to fire when we&#39;</span><span class="nx">re</span> <span class="nx">done</span> <span class="kd">with</span> <span class="nx">processed</span> <span class="nx">HTML</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlightExtractedCode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">codeBlocks</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">self</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">next</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">nextBlock</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">nextBlock</span> <span class="o">=</span> <span class="nx">codeBlocks</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">pygments</span><span class="p">(</span><span class="nx">nextBlock</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">nextBlock</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;pre&gt;/</span><span class="p">,</span> <span class="s2">&quot;&lt;pre&gt;&lt;code&gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\/pre&gt;/</span><span class="p">,</span> <span class="s2">&quot;&lt;/code&gt;&lt;/pre&gt;&quot;</span><span class="p">);</span>
          <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;\n~C&quot;</span> <span class="o">+</span> <span class="nx">nextBlock</span><span class="p">.</span><span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;C\n&quot;</span><span class="p">,</span> <span class="nx">out</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## addAnchors</p>


<div class="highlight"><pre><code><span class="n">Automatically</span> <span class="n">assign</span> <span class="n">an</span> <span class="n">id</span> <span class="n">to</span> <span class="n">each</span> <span class="n">section</span> <span class="n">based</span> <span class="n">on</span> <span class="n">any</span> <span class="n">headings</span><span class="p">.</span>

<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">object</span><span class="p">}</span> <span class="n">section</span> <span class="n">The</span> <span class="n">section</span> <span class="n">object</span> <span class="n">to</span> <span class="n">look</span> <span class="n">at</span>
<span class="p">@</span><span class="n">param</span> <span class="p">{</span><span class="n">number</span><span class="p">}</span> <span class="n">idx</span> <span class="n">The</span> <span class="n">index</span> <span class="n">of</span> <span class="n">the</span> <span class="n">section</span> <span class="n">in</span> <span class="n">the</span> <span class="n">whole</span> <span class="n">array</span><span class="p">.</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addAnchors</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">docHtml</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">headings</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">docHtml</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&lt;h[0-9]&gt;/</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">docHtml</span> <span class="o">=</span> <span class="nx">docHtml</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&lt;h([0-9])&gt;)(.*)(&lt;\/h\2&gt;)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">id</span><span class="p">;</span>
          <span class="nx">id</span> <span class="o">=</span> <span class="nx">middle</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;[^&gt;]*&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^a-zA-Z0-9\_\.]/g</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">);</span>
          <span class="nx">headings</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
            <span class="nx">text</span><span class="o">:</span> <span class="nx">middle</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;[^&gt;]*&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="nx">level</span><span class="o">:</span> <span class="nx">level</span>
          <span class="p">});</span>
          <span class="k">return</span> <span class="s2">&quot;\n&lt;div class=\&quot;pilwrap\&quot; id=\&quot;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;\n  &quot;</span> <span class="o">+</span> <span class="nx">start</span> <span class="o">+</span> <span class="s2">&quot;\n    &lt;a href=\&quot;#&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;\&quot; class=\&quot;pilcrow\&quot;&gt;&amp;#182;&lt;/a&gt;\n    &quot;</span> <span class="o">+</span> <span class="nx">middle</span> <span class="o">+</span> <span class="s2">&quot;\n  &quot;</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">+</span> <span class="s2">&quot;\n&lt;/div&gt;\n&quot;</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">docHtml</span> <span class="o">=</span> <span class="s2">&quot;\n&lt;div class=\&quot;pilwrap\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n  &lt;a class=\&quot;pilcrow\&quot; href=\&quot;#section-&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot; id=\&quot;section-&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;&amp;#182;&lt;/a&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&lt;/div&gt;\n&quot;</span> <span class="o">+</span> <span class="nx">docHtml</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">docHtml</span><span class="p">;</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## renderCodeHtml</p>


<div class="highlight"><pre><code><span class="nx">Given</span> <span class="nx">an</span> <span class="nx">array</span> <span class="nx">of</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">render</span> <span class="nx">them</span> <span class="nx">all</span> <span class="nx">out</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">nice</span> <span class="nx">HTML</span> <span class="nx">file</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">sections</span> <span class="nb">Array</span> <span class="nx">of</span> <span class="nx">sections</span> <span class="nx">containing</span> <span class="nx">parsed</span> <span class="nx">data</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">filename</span> <span class="nx">Name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">file</span> <span class="nx">being</span> <span class="nx">processed</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="nx">when</span> <span class="nx">we</span><span class="err">&#39;</span><span class="nx">re</span> <span class="nx">done</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderCodeHtml</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">headings</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">levels</span><span class="p">,</span> <span class="nx">outDir</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">pathSeparator</span><span class="p">,</span> <span class="nx">relDir</span><span class="p">,</span> <span class="nx">relativeOut</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span>
        <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">outFile</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
      <span class="nx">headings</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">outFile</span><span class="p">);</span>
      <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">relativeOut</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">outDir</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="nx">levels</span> <span class="o">=</span> <span class="p">(</span><span class="nx">relativeOut</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">relativeOut</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">relDir</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">);</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">section</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">docHtml</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">docHtml</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">headings</span><span class="p">);</span>
        <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
        <span class="nx">sections</span><span class="o">:</span> <span class="nx">sections</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">renderedCode</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">locals</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">locals</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
          <span class="nx">relativeDir</span><span class="o">:</span> <span class="nx">relDir</span><span class="p">,</span>
          <span class="nx">content</span><span class="o">:</span> <span class="nx">renderedCode</span><span class="p">,</span>
          <span class="nx">headings</span><span class="o">:</span> <span class="nx">headings</span><span class="p">,</span>
          <span class="nx">sidebar</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">,</span>
          <span class="nx">colourScheme</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">,</span>
          <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;tmpl&quot;</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">outFile</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">,</span> <span class="s2">&quot;Generated: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">outFile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## renderMarkdownHtml</p>


<div class="highlight"><pre><code><span class="nx">Renders</span> <span class="nx">the</span> <span class="nx">output</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">Markdown</span> <span class="nx">file</span> <span class="nx">into</span> <span class="nx">HTML</span>

<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">content</span> <span class="nx">The</span> <span class="nx">markdown</span> <span class="nx">file</span> <span class="nx">content</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">filename</span> <span class="nx">Name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">file</span> <span class="nx">being</span> <span class="nx">processed</span>
<span class="err">@</span><span class="nx">param</span> <span class="p">{</span><span class="kd">function</span><span class="p">}</span> <span class="nx">cb</span> <span class="nx">Callback</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">fire</span> <span class="nx">when</span> <span class="nx">we</span><span class="err">&#39;</span><span class="nx">re</span> <span class="nx">done</span>
</code></pre></div>

</div><div class="body"></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderMarkdownHtml</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_renderMarkdown</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">extractDocCode</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">headings</span><span class="p">,</span> <span class="nx">levels</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="nx">outDir</span><span class="p">,</span> <span class="nx">outFile</span><span class="p">,</span> <span class="nx">pathSeparator</span><span class="p">,</span> <span class="nx">relDir</span><span class="p">,</span> <span class="nx">relativeOut</span><span class="p">;</span>
        <span class="nx">headings</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;&lt;div class=\&quot;docs markdown\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">addAnchors</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">headings</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
        <span class="nx">outFile</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">outFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
        <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">outFile</span><span class="p">);</span>
        <span class="nx">pathSeparator</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^.*a|b.*$)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">relativeOut</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">outDir</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\/\\]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">levels</span> <span class="o">=</span> <span class="p">(</span><span class="nx">relativeOut</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">relativeOut</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">pathSeparator</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
        <span class="nx">relDir</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">);</span>
        <span class="nx">locals</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">title</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span>
          <span class="nx">relativeDir</span><span class="o">:</span> <span class="nx">relDir</span><span class="p">,</span>
          <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
          <span class="nx">headings</span><span class="o">:</span> <span class="nx">headings</span><span class="p">,</span>
          <span class="nx">colourScheme</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">,</span>
          <span class="nx">sidebar</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">sidebarState</span><span class="p">,</span>
          <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\\\/]/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;tmpl&quot;</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">outFile</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">,</span> <span class="s2">&quot;Generated: &quot;</span> <span class="o">+</span> <span class="nx">outFile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>!
    ## copySharedResources</p>


<div class="highlight"><pre><code><span class="n">Copies</span> <span class="n">the</span> <span class="n">shared</span> <span class="n">CSS</span> <span class="n">and</span> <span class="n">JS</span> <span class="n">files</span> <span class="n">to</span> <span class="n">the</span> <span class="n">output</span> <span class="n">directories</span>
</code></pre></div>

</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre>    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">copySharedResources</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">async</span><span class="p">,</span> <span class="nx">inPath_colorSchemeCSS</span><span class="p">,</span> <span class="nx">inPath_scriptJS</span><span class="p">,</span> <span class="nx">log</span><span class="p">,</span> <span class="nx">outPath_CSS</span><span class="p">,</span> <span class="nx">outPath_docScriptJS</span><span class="p">,</span> <span class="nx">outPath_filelistJS</span><span class="p">,</span> <span class="nx">outPath_indexHTML</span><span class="p">,</span>
        <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">inPath_scriptJS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;script.js&quot;</span><span class="p">);</span>
      <span class="nx">inPath_colorSchemeCSS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__filename</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s2">&quot;.css&quot;</span><span class="p">);</span>
      <span class="nx">outPath_docScriptJS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;doc-script.js&quot;</span><span class="p">);</span>
      <span class="nx">outPath_filelistJS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;doc-filelist.js&quot;</span><span class="p">);</span>
      <span class="nx">outPath_CSS</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;doc-style.css&quot;</span><span class="p">);</span>
      <span class="nx">outPath_indexHTML</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span><span class="p">);</span>
      <span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;async&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">async</span><span class="p">.</span><span class="nx">auto</span><span class="p">({</span>
        <span class="nx">readScriptJS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">inPath_scriptJS</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">readColorschemeCSS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">inPath_colorSchemeCSS</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">genPygmentsCSS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;pygmentize -S &quot;</span> <span class="o">+</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">colourScheme</span> <span class="o">+</span> <span class="s2">&quot; -f html -a &#39;body .highlight&#39;&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">stderr</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">readUserCSS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">async</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">css</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">mapCb</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span> <span class="nx">mapCb</span><span class="p">);</span>
          <span class="p">}),</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">renderIndexPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">index</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="p">{</span>
              <span class="nx">destination</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
            <span class="p">},</span> <span class="nx">cb</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">writeIndexPage</span><span class="o">:</span> <span class="p">[</span>
          <span class="s2">&quot;renderIndexPage&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">index</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_indexHTML</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">renderIndexPage</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">writeFilelistJS</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_filelistJS</span><span class="p">,</span> <span class="s2">&quot;var tree=&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">tree</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Saved file tree to doc-filelist.js&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">writeScriptJS</span><span class="o">:</span> <span class="p">[</span>
          <span class="s2">&quot;readScriptJS&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_docScriptJS</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">readScriptJS</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Copied JS to doc-script.js&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
              <span class="p">});</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">concatCSS</span><span class="o">:</span> <span class="p">[</span>
          <span class="s2">&quot;readColorschemeCSS&quot;</span><span class="p">,</span> <span class="s2">&quot;genPygmentsCSS&quot;</span><span class="p">,</span> <span class="s2">&quot;readUserCSS&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">readColorschemeCSS</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">results</span><span class="p">.</span><span class="nx">genPygmentsCSS</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">results</span><span class="p">.</span><span class="nx">readUserCSS</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">writeAllCSS</span><span class="o">:</span> <span class="p">[</span>
          <span class="s2">&quot;concatCSS&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span><span class="p">(</span><span class="nx">outPath_CSS</span><span class="p">,</span> <span class="nx">results</span><span class="p">.</span><span class="nx">concatCSS</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Copied all CSS to doc-style.css&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
              <span class="p">});</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">finished</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">outFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inDir</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">outDir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tplName</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">rendered</span><span class="p">,</span> <span class="nx">templatePath</span><span class="p">,</span> <span class="nx">tplFn</span><span class="p">;</span>
      <span class="nx">templatePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tplDir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">tplName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">tplExtension</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tplEngine</span> <span class="o">===</span> <span class="s2">&quot;internal&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tplFn</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">templatePath</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
        <span class="nx">rendered</span> <span class="o">=</span> <span class="nx">tplFn</span><span class="p">(</span><span class="nx">locals</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">consolidate</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">tplEngine</span><span class="p">](</span><span class="nx">templatePath</span><span class="p">,</span> <span class="nx">locals</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compileTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span> <span class="s2">&quot;var p=[],print=function(){p.push.apply(p,arguments);};&quot;</span> <span class="o">+</span> <span class="s2">&quot;with(obj){p.push(&#39;&quot;</span> <span class="o">+</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\r\t]/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&gt;)\s*\n+(\s*&lt;)/g</span><span class="p">,</span> <span class="s2">&quot;$1\n$2&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?=&lt;%[^=][^%]*)%&gt;\s*\n*\s*&lt;%(?=[^=])/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%&gt;\s*(?=\n)/g</span><span class="p">,</span> <span class="s2">&quot;%&gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?=\n)\s*&lt;%/g</span><span class="p">,</span> <span class="s2">&quot;&lt;%&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s2">&quot;~K&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/~K(?=[^%]*%&gt;)/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/~K/g</span><span class="p">,</span> <span class="s2">&quot;\\n&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;(?=[^%]*%&gt;)/g</span><span class="p">,</span> <span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%=(.+?)%&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&#39;,$1,&#39;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&lt;%&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;);&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;%&gt;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;p.push(&#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;);}return p.join(&#39;&#39;);&quot;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">doneLog</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">outDir</span><span class="p">;</span>
      <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">outDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">doneLog</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doneLog</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">doneCallback</span><span class="p">();</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span>

    <span class="nx">Otis</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeFileIfDifferent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">outDir</span><span class="p">;</span>
      <span class="nx">outDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nx">fileContent</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">callback</span><span class="p">()</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">outDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">Otis</span><span class="p">;</span>

  <span class="p">})();</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div></td></tr></tbody></table></div></body></html>