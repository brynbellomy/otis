<!DOCTYPE html><html><head><title>otis-bin.coffee</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="../doc-style.css"><script src="../doc-filelist.js"></script><script>var relativeDir = '../', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="../doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"><h1>otis-bin.coffee</h1></td><td class="code highlight"></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
</td><td class="code highlight"><div class="highlight"><pre><span class="c1">#!/usr/bin/env node</span>

<span class="c1"># Require all node modules</span>
<span class="nv">path     = </span><span class="nx">require</span> <span class="s">&quot;path&quot;</span>
<span class="nv">watchr   = </span><span class="nx">require</span> <span class="s">&quot;watchr&quot;</span>
<span class="nv">fs       = </span><span class="nx">require</span> <span class="s">&quot;fs&quot;</span>

<span class="p">{</span><span class="nx">Otis</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s">&quot;otis&quot;</span>

<span class="k">try</span>
  <span class="nx">require</span> <span class="s">&quot;colors&quot;</span>
<span class="k">catch</span> <span class="nx">e</span>
  <span class="k">for</span> <span class="nx">color</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="s">&quot;grey&quot;</span><span class="p">,</span> <span class="s">&quot;magenta&quot;</span><span class="p">,</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;underline&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;cyan&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">]</span>
    <span class="nb">String</span><span class="o">::</span><span class="nx">__defineGetter__</span> <span class="nx">color</span><span class="p">,</span> <span class="nf">() -&gt;</span> <span class="nx">@</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>


<span class="c1"># Figure out PWD because it doesn&#39;t exist in process.env on windows.</span>
<span class="nv">pwd = </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="s">&quot;.&quot;</span>

<span class="nv">configToUse = </span><span class="kc">null</span>
<span class="nv">argv = </span><span class="nx">require</span><span class="p">(</span><span class="s">&quot;optimist&quot;</span><span class="p">).</span><span class="nx">argv</span>
<span class="k">if</span> <span class="nx">argv</span><span class="o">?</span><span class="p">.</span><span class="nx">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;use&quot;</span> <span class="o">and</span> <span class="nx">argv</span><span class="o">?</span><span class="p">.</span><span class="nx">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">?</span> <span class="o">and</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">toString</span><span class="p">().</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>    <span class="c1"># being a little overcautious here, i know</span>
  <span class="nv">configToUse = </span><span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">toString</span><span class="p">().</span><span class="nx">trim</span><span class="p">()</span>

<span class="c1"># Check for various local config file and load then in order of least-specific to most-specific</span>
<span class="nv">configFilenames = </span><span class="p">[]</span>
<span class="k">if</span> <span class="nx">configToUse</span><span class="o">?</span>
  <span class="nv">homeCfg = </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">,</span> <span class="s">&quot;.otis&quot;</span><span class="p">,</span> <span class="s">&quot;otis.config.</span><span class="si">#{</span><span class="nx">configToUse</span><span class="si">}</span><span class="s">.js&quot;</span>
  <span class="nv">pwdCfg  = </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">pwd</span><span class="p">,</span> <span class="s">&quot;otis.config.</span><span class="si">#{</span><span class="nx">configToUse</span><span class="si">}</span><span class="s">.js&quot;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">homeCfg</span><span class="p">)</span> <span class="o">or</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">pwdCfg</span><span class="p">))</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Config </span><span class="si">#{</span><span class="nx">configToUse</span><span class="si">}</span><span class="s"> could not be found in ./ or ~/&quot;</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
  <span class="k">else</span>
    <span class="nx">configFilenames</span><span class="p">.</span><span class="nx">push</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">,</span> <span class="s">&quot;.otis&quot;</span><span class="p">,</span> <span class="s">&quot;otis.config.js&quot;</span><span class="p">)</span>
    <span class="nx">configFilenames</span><span class="p">.</span><span class="nx">push</span> <span class="nx">homeCfg</span>
    <span class="nx">configFilenames</span><span class="p">.</span><span class="nx">push</span> <span class="nx">pwdCfg</span>
<span class="k">else</span>
  <span class="nx">configFilenames</span><span class="p">.</span><span class="nx">push</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">,</span> <span class="s">&quot;.otis&quot;</span><span class="p">,</span> <span class="s">&quot;otis.config.js&quot;</span><span class="p">)</span>
  <span class="nx">configFilenames</span><span class="p">.</span><span class="nx">push</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">pwd</span><span class="p">,</span> <span class="s">&quot;otis.config.js&quot;</span><span class="p">)</span>

<span class="nv">localJSConfig = </span><span class="p">{}</span>
<span class="k">for</span> <span class="nx">filename</span> <span class="k">in</span> <span class="nx">configFilenames</span>
  <span class="k">try</span>
    <span class="nv">_localJSConfig = </span><span class="nx">require</span> <span class="nx">filename</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Using config file &#39;</span><span class="si">#{</span><span class="nx">filename</span><span class="si">}</span><span class="s">&#39;.&quot;</span>
    <span class="nx">localJSConfig</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">_localJSConfig</span> <span class="k">when</span> <span class="nx">_localJSConfig</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
  <span class="k">catch</span> <span class="nx">err</span>
    <span class="k">continue</span>

<span class="c1"># All program arguments using commander</span>
<span class="nv">optimist = </span><span class="nx">require</span><span class="p">(</span><span class="s">&quot;optimist&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">usage</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>

<span class="s">    ===============================================================================</span>
<span class="s">    DOCKER</span>
<span class="s">    Usage: $0 [use &lt;config&gt;] [options] [files to document]</span>

<span class="s">    When &#39;use &lt;config&gt;&#39; is present, otis will attempt to load config files in the</span>
<span class="s">    following order:</span>
<span class="s">        </span><span class="si">#{</span><span class="s">&quot;~/.otis/otis.config.js&quot;</span><span class="p">.</span><span class="nx">red</span><span class="si">}</span><span class="s"></span>
<span class="s">        </span><span class="si">#{</span><span class="s">&quot;~/.otis/otis.config.&lt;config&gt;.js&quot;</span><span class="p">.</span><span class="nx">red</span><span class="si">}</span><span class="s"></span>
<span class="s">        </span><span class="si">#{</span><span class="s">&quot;./otis.config.&lt;config&gt;.js&quot;</span><span class="p">.</span><span class="nx">red</span><span class="si">}</span><span class="s"></span>
<span class="s">        ... and will bail with an error if neither of the latter two could be found.</span>

<span class="s">    When there is no &#39;use &lt;config&gt;&#39; argument specified, otis will use this order</span>
<span class="s">    instead:</span>
<span class="s">        </span><span class="si">#{</span><span class="s">&quot;~/.otis/otis.config.js&quot;</span><span class="p">.</span><span class="nx">red</span><span class="si">}</span><span class="s"></span>
<span class="s">        </span><span class="si">#{</span><span class="s">&quot;./otis.config.js&quot;</span><span class="p">.</span><span class="nx">red</span><span class="si">}</span><span class="s"></span>

<span class="s">    </span><span class="si">#{</span><span class="s">&quot;~/.otis/&quot;</span><span class="p">.</span><span class="nx">red</span><span class="si">}</span><span class="s"> is also a great place to store your custom templates, etc. as well.</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;U&quot;</span><span class="p">,</span> <span class="s">&quot;use&quot;</span><span class="p">)</span>           
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;inDir&quot;</span><span class="p">)</span>         <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;Input directory (defaults to current dir)&quot;</span><span class="p">)</span>                   <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">inDir</span> <span class="o">?</span> <span class="nx">pwd</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="s">&quot;outDir&quot;</span><span class="p">)</span>        <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="s">&quot;Output directory (defaults to ./doc)&quot;</span><span class="p">)</span>                        <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">outDir</span> <span class="o">?</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">pwd</span><span class="p">,</span> <span class="s">&quot;doc&quot;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="s">&quot;tplDir&quot;</span><span class="p">)</span>        <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="s">&quot;Directory containing dox.&lt;ext&gt;, code.&lt;ext&gt;, and tmpl.&lt;ext&gt;&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">tplDir</span> <span class="o">?</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;res&quot;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="s">&quot;tplEngine&quot;</span><span class="p">)</span>     <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="s">&quot;Template parser (see github.com/visionmedia/consolidate.js)&quot;</span><span class="p">)</span> <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">tplEngine</span> <span class="o">?</span> <span class="s">&quot;internal&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="s">&quot;tplExtension&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="s">&quot;Template file extension &quot;</span><span class="p">)</span>                                    <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">tplExtension</span> <span class="o">?</span> <span class="s">&quot;jst&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span> <span class="s">&quot;markdownEngine&quot;</span><span class="p">).</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span> <span class="s">&quot;Only two choices, cowboy.&quot;</span><span class="p">)</span>                                   <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">markdownEngine</span> <span class="o">?</span> <span class="s">&quot;marked&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span> <span class="s">&quot;onlyUpdated&quot;</span><span class="p">)</span>   <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span> <span class="s">&quot;Only process files that have been changed&quot;</span><span class="p">)</span>                   <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">onlyUpdated</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;colourScheme&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;Color scheme to use (as in pygmentize -L styles)&quot;</span><span class="p">)</span>            <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">colourScheme</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;css&quot;</span><span class="p">)</span>           <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;CSS file to include after pygments CSS (you can specify this flag multiple times)&quot;</span><span class="p">).</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">css</span> <span class="o">?</span> <span class="p">[])</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">,</span> <span class="s">&quot;index&quot;</span><span class="p">)</span>         <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">,</span> <span class="s">&quot;Output an index.html page that instantly redirects to the specified file.&quot;</span><span class="p">).</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">index</span> <span class="o">?</span> <span class="kc">null</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;tolerant&quot;</span><span class="p">)</span>      <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;Will parse comments without a leading ! (ex: \&quot;/**! ...\&quot;)&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">tolerant</span> <span class="o">?</span> <span class="kc">false</span><span class="p">).</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&quot;T&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="s">&quot;watch&quot;</span><span class="p">)</span>         <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="s">&quot;Watch on the input directory for file changes (experimental)&quot;</span><span class="p">).</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">watch</span><span class="p">).</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="s">&quot;ignoreHidden&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="s">&quot;Ignore hidden files and directories (starting with . or _)&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">ignoreHidden</span><span class="p">).</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="s">&quot;sidebarState&quot;</span><span class="p">)</span>  <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="s">&quot;Whether the sidebar should be open or not by default&quot;</span><span class="p">)</span>        <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">sidebarState</span> <span class="o">?</span> <span class="s">&quot;yes&quot;</span><span class="p">).</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;exclude&quot;</span><span class="p">)</span>       <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;Paths to exclude&quot;</span><span class="p">)</span>                                            <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="nx">localJSConfig</span><span class="p">.</span><span class="nx">exclude</span> <span class="o">?</span> <span class="kc">false</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;W&quot;</span><span class="p">,</span> <span class="s">&quot;writeConfig&quot;</span><span class="p">)</span>   <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;W&quot;</span><span class="p">,</span> <span class="s">&quot;Write &#39;otis.config.js&#39; in PWD using the options provided.&quot;</span><span class="p">)</span> <span class="p">.</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;W&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">).</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&quot;W&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="s">&quot;help&quot;</span><span class="p">)</span>          <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="s">&quot;Show this help text.&quot;</span><span class="p">).</span><span class="nx">default</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">).</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">)</span>
  <span class="c1">#.wrap(80) # 80-col output</span>

<span class="nv">argv = </span><span class="nx">optimist</span><span class="p">.</span><span class="nx">argv</span>

<span class="c1"># show help and exit if the help flag was given or no input files were given</span>
<span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">help</span> <span class="o">or</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span>
  <span class="nx">optimist</span><span class="p">.</span><span class="nx">showHelp</span><span class="p">()</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>

<span class="c1"># make sure css arg is an array</span>
<span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">css</span> <span class="o">not</span> <span class="k">instanceof</span> <span class="nb">Array</span>
  <span class="nv">argv.css = </span><span class="p">[</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">css</span> <span class="p">]</span>
  <span class="nv">argv.y   = </span><span class="p">[</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">y</span> <span class="p">]</span>

<span class="c1"># Put all the options into an object</span>
<span class="nv">fields = </span><span class="p">[</span>
  <span class="s">&quot;inDir&quot;</span><span class="p">,</span>
  <span class="s">&quot;outDir&quot;</span><span class="p">,</span>
  <span class="s">&quot;tplDir&quot;</span><span class="p">,</span>
  <span class="s">&quot;tplEngine&quot;</span><span class="p">,</span>
  <span class="s">&quot;tplExtension&quot;</span><span class="p">,</span>
  <span class="s">&quot;markdownEngine&quot;</span><span class="p">,</span>
  <span class="s">&quot;onlyUpdated&quot;</span><span class="p">,</span>
  <span class="s">&quot;colourScheme&quot;</span><span class="p">,</span>
  <span class="s">&quot;css&quot;</span><span class="p">,</span>
  <span class="s">&quot;index&quot;</span><span class="p">,</span>
  <span class="s">&quot;tolerant&quot;</span><span class="p">,</span>
  <span class="s">&quot;ignoreHidden&quot;</span><span class="p">,</span>
  <span class="s">&quot;sidebarState&quot;</span><span class="p">,</span>
  <span class="s">&quot;exclude&quot;</span>
<span class="p">]</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Options:&quot;</span><span class="p">.</span><span class="nx">white</span><span class="p">.</span><span class="nx">bold</span>
<span class="nv">opts = </span><span class="p">{}</span>
<span class="k">for</span> <span class="nx">field</span> <span class="k">in</span> <span class="nx">fields</span> <span class="k">when</span> <span class="k">typeof</span> <span class="nx">argv</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">isnt</span> <span class="kc">undefined</span>
  <span class="nx">opts</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="nx">argv</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">field</span><span class="p">.</span><span class="nx">red</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span><span class="p">.</span><span class="nx">white</span> <span class="o">+</span> <span class="p">(</span><span class="nx">opts</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">?</span> <span class="s">&quot;-&quot;</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">grey</span>

<span class="c1"># write a otis.config.js file if the writeConfig option was specified</span>
<span class="k">if</span> <span class="nx">argv</span><span class="o">?</span><span class="p">.</span><span class="nx">writeConfig</span> <span class="o">is</span> <span class="kc">yes</span>
  <span class="nx">require</span><span class="p">(</span><span class="s">&quot;fs&quot;</span><span class="p">).</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">pwd</span><span class="p">,</span> <span class="s">&quot;otis.config.js&quot;</span><span class="p">),</span>
    <span class="s">&quot;&quot;&quot;</span>
<span class="s">    module.exports = </span><span class="si">#{</span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;util&#39;</span><span class="p">).</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span><span class="si">}</span><span class="s">;</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;utf8&quot;</span><span class="p">)</span>

<span class="c1"># Create otis instance</span>
<span class="nv">d = </span><span class="k">new</span> <span class="nx">Otis</span> <span class="nx">opts</span>

<span class="nv">args = </span><span class="nx">argv</span><span class="p">.</span><span class="nx">_</span>
<span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
  <span class="c1"># make sure we remove the &#39;use x&#39; args from the args list before passing to otis</span>
  <span class="nv">newArgv = </span><span class="p">[]</span>
  <span class="nv">i = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">if</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;use&quot;</span> <span class="k">then</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">else</span>
      <span class="nx">newArgv</span><span class="p">.</span><span class="nx">push</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="nx">i</span><span class="o">++</span>
  <span class="nv">args = </span><span class="nx">newArgv</span>


<span class="c1"># Set it running.</span>
<span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">watch</span> <span class="k">then</span> <span class="nx">d</span><span class="p">.</span><span class="nx">watch</span> <span class="nx">args</span>
<span class="k">else</span>               <span class="nx">d</span><span class="p">.</span><span class="nx">doc</span>   <span class="nx">args</span>
</pre></div></td></tr></tbody></table></div></body></html>