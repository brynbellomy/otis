<!DOCTYPE html><html><head><title>script.js</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="../doc-style.css"><script src="../doc-filelist.js"></script><script>var relativeDir = '../', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="../doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"></td><td class="code highlight"></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
</td><td class="code highlight"><div class="highlight"><pre><span class="c1">// # res/script.js</span>
<span class="c1">//</span>
<span class="c1">// This is the script file that gets copied into the output. It mainly manages the display</span>
<span class="c1">// of the folder tree. The idea of this script file is to be minimal and standalone. So</span>
<span class="c1">// that means no jQuery.</span>

<span class="c1">// Use localStorage to store data about the tree&#39;s state: whether or not</span>
<span class="c1">// the tree is visible and which directories are expanded. Unless the state</span>
<span class="kd">var</span> <span class="nx">sidebarVisible</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_showSidebar</span><span class="p">)</span> <span class="o">?</span>
                        <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_showSidebar</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span> <span class="o">:</span>
                        <span class="nx">defaultSidebar</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * ## makeTree</span>
<span class="cm"> *</span>
<span class="cm"> * Consructs the folder tree view</span>
<span class="cm"> *</span>
<span class="cm"> * @param {object} treeData Folder structure as in [queueFile](../src/otis.js.html#otis.prototype.queuefile)</span>
<span class="cm"> * @param {string} root Path from current file to root (ie `&#39;../../&#39;` etc.)</span>
<span class="cm"> * @param {string} filename The current file name</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">makeTree</span><span class="p">(</span><span class="nx">treeData</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">filename</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">treeNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">treeHandle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sidebar-toggle&#39;</span><span class="p">);</span>
  <span class="nx">treeHandle</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">toggleTree</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

  <span class="c1">// Build the html and add it to the container.</span>
  <span class="nx">treeNode</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">nodeHtml</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">treeData</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>

  <span class="c1">// Root folder (whole tree) should always be open</span>
  <span class="nx">treeNode</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; open&#39;</span><span class="p">;</span>

  <span class="c1">// Attach click event handler</span>
  <span class="nx">treeNode</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">nodeClicked</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">sidebarVisible</span><span class="p">)</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; sidebar&#39;</span><span class="p">;</span>

  <span class="c1">// Restore scroll position from localStorage if set. And attach scroll handler</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_treeScroll</span><span class="p">)</span> <span class="nx">treeNode</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_treeScroll</span><span class="p">;</span>
  <span class="nx">treeNode</span><span class="p">.</span><span class="nx">onscroll</span> <span class="o">=</span> <span class="nx">treeScrolled</span><span class="p">;</span>

  <span class="c1">// Only set a class to allow CSS transitions after the tree state has been painted</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; slidey&#39;</span><span class="p">;</span> <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ## treeScrolled</span>
<span class="cm"> *</span>
<span class="cm"> * Called when the tree is scrolled. Stores the scroll position in localStorage</span>
<span class="cm"> * so it can be restored on the next pageview.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">treeScrolled</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">tree</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_treeScroll</span> <span class="o">=</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ## nodeClicked</span>
<span class="cm"> *</span>
<span class="cm"> * Called when a directory is clicked. Toggles open state of the directory</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Event} e The click event</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">nodeClicked</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>

  <span class="c1">// Find the target</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>

  <span class="c1">// If the click target is actually a file (rather than a directory), ignore it</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">tagName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;div&#39;</span> <span class="o">||</span> <span class="nx">t</span><span class="p">.</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">&#39;children&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="c1">// Recurse upwards until we find the actual directory node</span>
  <span class="k">while</span><span class="p">(</span><span class="nx">t</span> <span class="o">&amp;&amp;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;dir&#39;</span><span class="p">)</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>

  <span class="c1">// If we&#39;re at the root node, then do nothing (we don&#39;t allow collapsing of the whole tree)</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span> <span class="o">||</span> <span class="nx">t</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="s1">&#39;tree&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="c1">// Find the path and toggle the state, saving the state in the localStorage variable</span>
  <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">className</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*open/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;otis_openPath:&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; open&#39;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">[</span><span class="s1">&#39;otis_openPath:&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="cm">/**</span>
<span class="cm"> * ## nodeHtml</span>
<span class="cm"> *</span>
<span class="cm"> * Constructs the markup for a directory in the tree</span>
<span class="cm"> *</span>
<span class="cm"> * @param {string} nodename The node name.</span>
<span class="cm"> * @param {object} node Node object of same format as whole tree.</span>
<span class="cm"> * @param {string} path The path form the base to this node</span>
<span class="cm"> * @param {string} root Relative path from current page to root</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">nodeHtml</span><span class="p">(</span><span class="nx">nodename</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">root</span><span class="p">){</span>
  <span class="c1">// Firstly, figure out whether or not the directory is expanded from localStorage</span>
  <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">[</span><span class="s1">&#39;otis_openPath:&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;dir&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">isOpen</span> <span class="o">?</span> <span class="s1">&#39; open&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; rel=&quot;&#39;</span> <span class="o">+</span> <span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>
  <span class="nx">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;nodename&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">nodename</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
  <span class="nx">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;children&quot;&gt;&#39;</span><span class="p">;</span>

  <span class="c1">// Loop through all child directories first</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">dirs</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">dirs</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">dirs</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">dirs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="nx">dirs</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="nx">nodeHtml</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">dirs</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">path</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="c1">// Have to store them in an array first and then sort them alphabetically here</span>
    <span class="nx">dirs</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">){</span> <span class="k">return</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">name</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">});</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">dirs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">k</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">out</span> <span class="o">+=</span> <span class="nx">dirs</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">html</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Now loop through all the child files alphabetically</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">files</span><span class="p">){</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
      <span class="nx">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;a class=&quot;file&quot; href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">root</span> <span class="o">+</span> <span class="nx">path</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.html&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Close things off</span>
  <span class="nx">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ## toggleTree</span>
<span class="cm"> *</span>
<span class="cm"> * Toggles the visibility of the folder tree</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">toggleTree</span><span class="p">(){</span>
  <span class="c1">// Do the actual toggling by modifying the class on the body element. That way we can get some nice CSS transitions going.</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">sidebarVisible</span><span class="p">){</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*sidebar/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="nx">sidebarVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; sidebar&#39;</span><span class="p">;</span>
    <span class="nx">sidebarVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">sidebarVisible</span><span class="p">){</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_showSidebar</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_showSidebar</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ## wireUpTabs</span>
<span class="cm"> *</span>
<span class="cm"> * Wires up events on the sidebar tabe</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">wireUpTabs</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">tabEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sidebar_switch&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">tabEl</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>

  <span class="c1">// Each tab has a class corresponding of the id of its tab pane</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span>  <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="c1">// Ignore text nodes</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span> <span class="nx">switchTab</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span> <span class="p">};</span>
    <span class="p">}(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ## switchTab</span>
<span class="cm"> *</span>
<span class="cm"> * Switches tabs in the sidebar</span>
<span class="cm"> *</span>
<span class="cm"> * @param {string} tab The ID of the tab to switch to</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">switchTab</span><span class="p">(</span><span class="nx">tab</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">tabEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;sidebar_switch&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">tabEl</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>

  <span class="c1">// Easiest way to go through tabs without any kind of selector is just to look at the tab bar</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span>  <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="c1">// Ignore text nodes</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="c1">// Figure out what tab pane this tab button corresponts to</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s.*$/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">t</span> <span class="o">===</span> <span class="nx">tab</span><span class="p">){</span>
      <span class="c1">// Show the tab pane, select the tab button</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; selected&#39;</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="c1">// Hide the tab pane, deselect the tab button</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
      <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\sselected/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Store the last open tab in localStorage</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_sidebarTab</span> <span class="o">=</span> <span class="nx">tab</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ## window.onload</span>
<span class="cm"> *</span>
<span class="cm"> * When the document is ready, make the sidebar and all that jazz</span>
<span class="cm"> */</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">makeTree</span><span class="p">(</span><span class="nx">tree</span><span class="p">,</span> <span class="nx">relativeDir</span><span class="p">,</span> <span class="nx">thisFile</span><span class="p">);</span>
  <span class="nx">wireUpTabs</span><span class="p">();</span>

  <span class="c1">// Switch to the last viewed sidebar tab if stored, otherwise default to folder tree</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_sidebarTab</span><span class="p">){</span>
    <span class="nx">switchTab</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">otis_sidebarTab</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nx">switchTab</span><span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div></td></tr></tbody></table></div></body></html>